<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="Utilities-MMG-Process.md,  ">

<title>Utilities MMG Process | Kratos Multiphysics Documentation</title>

<link rel="stylesheet" href="/css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/modern-business.css">

<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/customstyles.css">
<link rel="stylesheet" href="/css/boxshadowproperties.css">

<!-- Most color styles are extracted out to here -->
<link rel="stylesheet" href="/css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<!-- MathJax.js -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script src="/js/toc.js"></script>
<script src="/js/customscripts.js"></script>

<link rel="shortcut icon" href="/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/">&nbsp;<span class="projectTitle"> Kratos Multiphysics Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/KratosMultiphysics/Kratos" target="_blank" rel="noopener">GitHub</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Kratos<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Kratos/For_Users/General/Overview.html">For Users</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/For_Developers/General/Application-Cases.html">For Developers</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Processes/General/Overview.html">Processes</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Utilities/General/Overview.html">Utilities</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Debugging/General/Checking-memory-usage-with-Valgrind.html">Debugging</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Documentation_Guide/General/Overview.html">Documentation Guide</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Workshops/2019/running_an_example_from_GiD.html">Workshops</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Applications<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Applications/Discrete_Element_Modelling_Application/General/Basic-DEM-Benchmarking.html">Discrete Element Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid-Structure_Interaction_Application/General/2D-Mok-benchmark.html">Fluid-Structure Interaction Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid_Dynamics_Application/General/2D-Cavity-flow-problem.html">Fluid Dynamics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Mapping_Application/General/How-to-do-Mapping-between-nonmatching-meshes.html">Mapping Application</a></li>
                        
                        
                        
                        <li class="dropdownActive"><a href="/pages/Applications/Meshing_Application/General/Utilities-MMG-Process.html">Meshing Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Particle_Mechanics_Application/General/Overview.html">Particle Mechanics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Reduced_Order_Modelling_Application/General/API-for-RomApplication-(draft-to-be-moved-elsewhere).html">Reduced Order Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Statistics_Application/General/Overview.html">Statistics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Structural_Mechanics_Application/General/0_Roll-up-beam-cantilever.html">Structural Mechanics Application</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:kratosmultiphysics@gmail.com?subject=Kratos Multiphysics Documentation feedback&body=I have some feedback about the Utilities MMG Process page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: '/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Utilities MMG Process">{title}</a></li>',
                    noResultsText: '',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Meshing Application </li>
  
  
  
  <li>
      <a title="General" href="#">General</a>
      <ul>
          
          
          
          <li class="active"><a title="Utilities MMG Process" href="/pages/Applications/Meshing_Application/General/Utilities-MMG-Process.html">Utilities MMG Process</a></li>
          
          
          
          
          
          
          <li><a title="Utilities ParMmg Process" href="/pages/Applications/Meshing_Application/General/Utilities-ParMmg-Process.html">Utilities ParMmg Process</a></li>
          
          
          
          
      </ul>
  </li>
  
  
  
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Utilities MMG Process</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" rel="noopener" href="https://github.com/KratosMultiphysics/Kratos/tree/master/docs/pages/Applications/Meshing_Application/General/Utilities-MMG-Process.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

   <h1 id="content">Content</h1>
<ul>
  <li><a href="https://github.com/KratosMultiphysics/Kratos/wiki/%5BUtilities%5D-MMG-Process#what-is-mmg">What is MMG?</a></li>
  <li><a href="https://github.com/KratosMultiphysics/Kratos/wiki/%5BUtilities%5D-MMG-Process#how-can-i-install-this-library">How can I install this library?</a></li>
  <li><a href="https://github.com/KratosMultiphysics/Kratos/wiki/%5BUtilities%5D-MMG-Process#once-it-is-compiled">Once it is compiled</a></li>
  <li><a href="https://github.com/KratosMultiphysics/Kratos/wiki/%5BUtilities%5D-MMG-Process#how-can-i-use-this-library">How can I use this library?</a>
    <ul>
      <li><a href="https://github.com/KratosMultiphysics/Kratos/wiki/%5BUtilities%5D-MMG-Process#manually">Manually</a></li>
      <li><a href="https://github.com/KratosMultiphysics/Kratos/wiki/%5BUtilities%5D-MMG-Process#using-the-process">Using the process</a></li>
      <li><a href="https://github.com/KratosMultiphysics/Examples/tree/master/mmg_remeshing_examples">Examples</a></li>
    </ul>
  </li>
</ul>

<h1 id="what-is-mmg">What is MMG?</h1>

<p><em>MMG</em> is an open source software for simplicial remeshing. <a href="http://www.mmgtools.org/"><em>MMG</em> main page</a>, and you can download the code in <a href="https://github.com/MmgTools/mmg">GitHub</a>.</p>

<ul>
  <li>It provides 3 applications and 4 libraries:
    <ul>
      <li>The <code class="language-plaintext highlighter-rouge">mmg2d</code> application and the <code class="language-plaintext highlighter-rouge">libmmg2d</code> library: adaptation and optimization of a two-dimensional triangulation and generation of a triangulation from a set of points or from given boundary edges</li>
      <li>The <code class="language-plaintext highlighter-rouge">mmgs</code> application and the <code class="language-plaintext highlighter-rouge">libmmgs</code> library: adaptation and optimization of a surface triangulation and isovalue discretization</li>
      <li>The <code class="language-plaintext highlighter-rouge">mmg3d</code> application and the <code class="language-plaintext highlighter-rouge">libmmg3d</code> library: adaptation and optimization of a tetrahedral mesh and implicit domain meshing</li>
      <li>The <code class="language-plaintext highlighter-rouge">libmmg</code> library gathering the <code class="language-plaintext highlighter-rouge">libmmg2d</code>, <code class="language-plaintext highlighter-rouge">libmmgs</code> and <code class="language-plaintext highlighter-rouge">libmmg3d</code> libraries</li>
    </ul>
  </li>
  <li>It uses a <a href="https://www.gnu.org/licenses/lgpl-3.0.en.html">LGPL</a> license and it has been integrated in <em>Kratos</em> via the <code class="language-plaintext highlighter-rouge">mmg_process.h</code> in the <code class="language-plaintext highlighter-rouge">MeshingApplication</code>. 
<span style="color:red">Important: For use it you need to download first (look in the installation section)</span></li>
  <li>It is used like a process, using the <code class="language-plaintext highlighter-rouge">mmg_process.py</code> in the <code class="language-plaintext highlighter-rouge">MeshingApplication</code>.</li>
  <li>There are basically two different types of re-meshing strategies (both of them compatibles with an anisotropic re-meshing):
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Level-Set</code>: This re-meshing technique is based in the gradient of the <code class="language-plaintext highlighter-rouge">DISTANCE</code> function, and can be used to re-mesh when you are getting closer to the reference geometry.</li>
      <li><code class="language-plaintext highlighter-rouge">Hessian</code>: This re-meshing technique is based in the computation of the Hessian of any variable, in the case of more than one variable or a variable by components is considered them the intersection of the corresponding tensors is computed.</li>
    </ul>
  </li>
</ul>

<p><img src="https://raw.githubusercontent.com/KratosMultiphysics/Examples/master/mmg_remeshing_examples/validation/bunny/data/Bunny.png" alt="" /></p>

<h1 id="how-can-i-install-this-library">How can I install this library?</h1>

<p>The installation of the library is fortunately quite straightforward thanks to the marvels of the configure scripts. The easiest way is the following one, because requires the minimal effort; of course if you have expertise you can find an alternative way to install the library:</p>

<ul>
  <li>Go to <code class="language-plaintext highlighter-rouge">MeshingApplication/custom_external_libraries/</code>
    <ul>
      <li>Here you can see the <code class="language-plaintext highlighter-rouge">mmg</code> folder, but it is empty. You have the <code class="language-plaintext highlighter-rouge">README.txt</code>, where the installation is explained, and the build folder, where the <code class="language-plaintext highlighter-rouge">configure.sh</code> script can be found.</li>
      <li>Go to a folder of your chose to install the library (for example <code class="language-plaintext highlighter-rouge">~/src</code>) (make sure you have installed <code class="language-plaintext highlighter-rouge">git</code> first):</li>
    </ul>
  </li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/MmgTools/mmg.git
</code></pre></div></div>

<ul>
  <li>Then copy the <code class="language-plaintext highlighter-rouge">build</code> folder from the old <code class="language-plaintext highlighter-rouge">mmg</code> folder to the new <code class="language-plaintext highlighter-rouge">mmg</code> folder. Go to the build folder and execute:</li>
</ul>

<p>Linux</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh configure.sh
</code></pre></div></div>
<p>Windows
(Command prompt)</p>
<pre><code class="language-cmd">configure.bat
</code></pre>
<p>Windows
(Powershell)</p>
<pre><code class="language-cmd">./configure.bat
</code></pre>

<ul>
  <li>Once the compilation is done go to the main <em>Kratos</em> folder and go to your <code class="language-plaintext highlighter-rouge">scripts</code> folder. Here you modify the <code class="language-plaintext highlighter-rouge">configure.sh</code> or <code class="language-plaintext highlighter-rouge">configure.bat</code> adding the following lines (modify the <code class="language-plaintext highlighter-rouge">kratos_dir</code> for your current <em>Kratos</em> installation directory):</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-DINCLUDE_MMG</span><span class="o">=</span>ON                                                     <span class="se">\</span>
<span class="nt">-DMMG_ROOT</span><span class="o">=</span><span class="s2">"/path/to/src/mmg/build"</span>                                         <span class="se">\</span>
</code></pre></div></div>

<p>It will be assumed that the libraries folder is under <code class="language-plaintext highlighter-rouge">/path/to/srtc/mmg/build/lib</code>. In case your libraries are not detected automatically, you can specify the path by using:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-DINCLUDE_MMG</span><span class="o">=</span>ON                                                    <span class="se">\</span>
<span class="nt">-DMMG_BUILDDIR</span><span class="o">=</span><span class="s2">"/path/to/src/mmg/build"</span>                             <span class="se">\</span>
<span class="nt">-DMMG_LIBDIR</span><span class="o">=</span><span class="s2">"/path/to/custom/mmg/lib"</span>                              <span class="se">\</span>
</code></pre></div></div>

<p><strong>In Windows, it is possible that the build  folder was written in your C://Program Files/ folder</strong></p>

<p>Further information and possible errors are covered in <a href="https://github.com/KratosMultiphysics/Kratos/blob/master/applications/MeshingApplication/custom_external_libraries/mmg/README.md">this README.</a></p>
<ul>
  <li>After that recompile Kratos using again:
Linux
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh Kratos/scripts/configure.sh
</code></pre></div>    </div>
    <p>Windows</p>
    <div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">Kratos</span><span class="na">/scripts/configure</span>.sh
</code></pre></div>    </div>
  </li>
</ul>

<p>Once Kratos is compiled, you will have to tell the OS where to find the libraries. You can do that by executing this command.</p>

<p>Linux</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"export LD_LIBRARY_PATH=</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">:/path/to/my/src/folder/mmg/build/lib"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HOME</span>/.bashrc
</code></pre></div></div>

<p>Windows:</p>

<p>If the MMG folder was written to “C://Program Files/” you won’t need to add it to the environment variables.</p>

<p>Otherwise:</p>

<p>In a Command Prompt:</p>
<pre><code class="language-cmd">set PATH=%PATH%;C:/path/to/mmg/libs
</code></pre>
<p>In Windows Powershell:</p>
<pre><code class="language-cmd">$Env:PATH+=";C:/path/to/mmg/libs"
</code></pre>

<p>Or set them permanently using the <strong>Edit the system environment variables option</strong> in the Control panel</p>

<h1 id="once-it-is-compiled">Once it is compiled</h1>

<p>Go to the folder tests in the <code class="language-plaintext highlighter-rouge">MeshingApplication</code> and run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 test_MeshingApplication.py
</code></pre></div></div>

<p>You should get an OK, if you don’t get an OK there is something wrong:</p>

<ul>
  <li>Check that your compilation is the correct one
    <ul>
      <li>Follow again all the steps</li>
      <li>Check that the configure.sh it is correctly compiled</li>
    </ul>
  </li>
  <li>If you get an <code class="language-plaintext highlighter-rouge">Unexpected error</code>:
    <ul>
      <li>This problem is because your machine is not compatible with the library, unfortunately this means that you need to wait until the problem is solved</li>
    </ul>
  </li>
</ul>

<h1 id="how-can-i-use-this-library">How can I use this library?</h1>

<h2 id="manually">Manually</h2>

<p>Taking for example the following <a href="https://github.com/KratosMultiphysics/Examples/tree/master/mmg_remeshing_examples/use_cases/coarse_sphere">mesh</a>, and using the following python script (included in the previous compressed file) it is possible to re-mesh a very coarsed mesh of a sphere into a fine an anisotropic sphere.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span> <span class="c1">#makes KratosMultiphysics backward compatible with python 2.6 and 2.7
</span>
<span class="kn">import</span> <span class="nn">KratosMultiphysics</span>
<span class="kn">import</span> <span class="nn">KratosMultiphysics.MeshingApplication</span> <span class="k">as</span> <span class="n">MeshingApplication</span>

<span class="n">current_model</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Model</span><span class="p">()</span>
<span class="n">main_model_part</span> <span class="o">=</span> <span class="n">current_model</span><span class="p">.</span><span class="n">CreateModelPart</span><span class="p">(</span><span class="s">"MainModelPart"</span><span class="p">)</span>
<span class="n">main_model_part</span><span class="p">.</span><span class="n">ProcessInfo</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DOMAIN_SIZE</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># We add the variables needed 
</span><span class="n">main_model_part</span><span class="p">.</span><span class="n">AddNodalSolutionStepVariable</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DISTANCE</span><span class="p">)</span>
<span class="n">main_model_part</span><span class="p">.</span><span class="n">AddNodalSolutionStepVariable</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DISTANCE_GRADIENT</span><span class="p">)</span>
<span class="n">main_model_part</span><span class="p">.</span><span class="n">AddNodalSolutionStepVariable</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">NODAL_AREA</span><span class="p">)</span>

<span class="c1"># We import the model main_model_part
</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">ModelPartIO</span><span class="p">(</span><span class="s">"coarse_sphere"</span><span class="p">).</span><span class="n">ReadModelPart</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">)</span>

<span class="c1"># We calculate the gradient of the distance variable
</span><span class="n">local_gradient</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">ComputeNodalGradientProcess3D</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">,</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DISTANCE</span><span class="p">,</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DISTANCE_GRADIENT</span><span class="p">,</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">NODAL_AREA</span><span class="p">)</span>
<span class="n">local_gradient</span><span class="p">.</span><span class="n">Execute</span><span class="p">()</span>

<span class="c1"># We set to zero the metric
</span><span class="n">ZeroVector</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
<span class="n">ZeroVector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">ZeroVector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">ZeroVector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">ZeroVector</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">ZeroVector</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">ZeroVector</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">main_model_part</span><span class="p">.</span><span class="n">Nodes</span><span class="p">:</span>
    <span class="n">node</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">MeshingApplication</span><span class="p">.</span><span class="n">METRIC_TENSOR_3D</span><span class="p">,</span> <span class="n">ZeroVector</span><span class="p">)</span>
            
<span class="c1"># We define a metric using the ComputeLevelSetSolMetricProcess
</span><span class="n">level_set_param</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Parameters</span><span class="p">(</span><span class="s">"""
                        {
                            "minimal_size"                         : 0.1, 
                            "enforce_current"                      : false, 
                            "anisotropy_remeshing"                 : true, 
                            "anisotropy_parameters": 
                            {
                                "hmin_over_hmax_anisotropic_ratio"      : 0.01, 
                                "boundary_layer_max_distance"           : 0.5, 
                                "interpolation"                         : "Linear"
                            }
                        }
                        """</span><span class="p">)</span>
<span class="n">metric_process</span> <span class="o">=</span> <span class="n">MeshingApplication</span><span class="p">.</span><span class="n">ComputeLevelSetSolMetricProcess3D</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">,</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DISTANCE_GRADIENT</span><span class="p">,</span><span class="n">level_set_param</span><span class="p">)</span>
<span class="n">metric_process</span><span class="p">.</span><span class="n">Execute</span><span class="p">()</span>

<span class="c1"># We create the remeshing process
</span><span class="n">remesh_param</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Parameters</span><span class="p">(</span><span class="s">"""{ }"""</span><span class="p">)</span>
<span class="n">MmgProcess</span> <span class="o">=</span> <span class="n">MeshingApplication</span><span class="p">.</span><span class="n">MmgProcess3D</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">,</span> <span class="n">remesh_param</span><span class="p">)</span>
<span class="n">MmgProcess</span><span class="p">.</span><span class="n">Execute</span><span class="p">()</span>

<span class="c1"># Finally we export to GiD
</span><span class="kn">from</span> <span class="nn">gid_output_process</span> <span class="kn">import</span> <span class="n">GiDOutputProcess</span>
<span class="n">gid_output</span> <span class="o">=</span> <span class="n">GiDOutputProcess</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">,</span>
                            <span class="s">"gid_output"</span><span class="p">,</span>
                            <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Parameters</span><span class="p">(</span><span class="s">"""
                                {
                                    "result_file_configuration" : {
                                        "gidpost_flags": {
                                            "GiDPostMode": "GiD_PostBinary",
                                            "WriteDeformedMeshFlag": "WriteUndeformed",
                                            "WriteConditionsFlag": "WriteConditions",
                                            "MultiFileFlag": "SingleFile"
                                        },        
                                        "nodal_results"       : []
                                    }
                                }
                                """</span><span class="p">)</span>
                            <span class="p">)</span>

<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteInitialize</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteBeforeSolutionLoop</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteInitializeSolutionStep</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">PrintOutput</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteFinalizeSolutionStep</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteFinalize</span><span class="p">()</span>   
</code></pre></div></div>

<p>The metric can be calculated by hand if you prefer, for example to get the same result than the previous script:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># We import the libraies
</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span> <span class="c1">#makes KratosMultiphysics backward compatible with python 2.6 and 2.7
</span>
<span class="kn">import</span> <span class="nn">KratosMultiphysics</span>
<span class="kn">import</span> <span class="nn">KratosMultiphysics.MeshingApplication</span> <span class="k">as</span> <span class="n">MeshingApplication</span>

<span class="c1"># We create the model part
</span><span class="n">current_model</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Model</span><span class="p">()</span>
<span class="n">main_model_part</span> <span class="o">=</span> <span class="n">current_model</span><span class="p">.</span><span class="n">CreateModelPart</span><span class="p">(</span><span class="s">"MainModelPart"</span><span class="p">)</span>
<span class="n">main_model_part</span><span class="p">.</span><span class="n">ProcessInfo</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DOMAIN_SIZE</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># We add the variables needed 
</span><span class="n">main_model_part</span><span class="p">.</span><span class="n">AddNodalSolutionStepVariable</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DISTANCE</span><span class="p">)</span>
<span class="n">main_model_part</span><span class="p">.</span><span class="n">AddNodalSolutionStepVariable</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">NODAL_H</span><span class="p">)</span>

<span class="c1"># We import the model main_model_part
</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">ModelPartIO</span><span class="p">(</span><span class="s">"coarse_sphere"</span><span class="p">).</span><span class="n">ReadModelPart</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">)</span>

<span class="c1"># We know that the gradient is unitary and in X direction
</span><span class="n">UnityVector</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 
<span class="n">UnityVector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">UnityVector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">UnityVector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># We set to zero the metric
</span><span class="n">MetricVector</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">main_model_part</span><span class="p">.</span><span class="n">Nodes</span><span class="p">:</span>
    <span class="c1"># Calculate the element size
</span>    <span class="n">distance</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">GetSolutionStepValue</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">DISTANCE</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">nodal_h</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">GetSolutionStepValue</span><span class="p">(</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">NODAL_H</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">element_size</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
        <span class="n">element_size</span> <span class="o">=</span> <span class="n">nodal_h</span>

    <span class="c1"># Calculate anisotropic ratio
</span>    <span class="n">ratio</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">+</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span><span class="o">/</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">);</span>

    <span class="c1"># We get the gradient
</span>    <span class="n">gradient_value</span> <span class="o">=</span> <span class="n">UnityVector</span>

    <span class="c1"># Finally we calculate the metric
</span>    <span class="n">coeff0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">element_size</span> <span class="o">*</span> <span class="n">element_size</span><span class="p">);</span>
    <span class="n">coeff1</span> <span class="o">=</span> <span class="n">coeff0</span><span class="o">/</span><span class="p">(</span><span class="n">ratio</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">);</span>

    <span class="n">v0v0</span> <span class="o">=</span> <span class="n">gradient_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">gradient_value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">v0v1</span> <span class="o">=</span> <span class="n">gradient_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">gradient_value</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">v0v2</span> <span class="o">=</span> <span class="n">gradient_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">gradient_value</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">v1v1</span> <span class="o">=</span> <span class="n">gradient_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">gradient_value</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">v1v2</span> <span class="o">=</span> <span class="n">gradient_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">gradient_value</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">v2v2</span> <span class="o">=</span> <span class="n">gradient_value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">gradient_value</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

    <span class="n">MetricVector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">v0v0</span><span class="p">)</span> <span class="o">+</span> <span class="n">coeff1</span><span class="o">*</span><span class="n">v0v0</span>
    <span class="n">MetricVector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">v1v1</span><span class="p">)</span> <span class="o">+</span> <span class="n">coeff1</span><span class="o">*</span><span class="n">v1v1</span>
    <span class="n">MetricVector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">v2v2</span><span class="p">)</span> <span class="o">+</span> <span class="n">coeff1</span><span class="o">*</span><span class="n">v2v2</span>
    <span class="n">MetricVector</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff0</span><span class="o">*</span><span class="p">(</span>    <span class="o">-</span> <span class="n">v0v1</span><span class="p">)</span> <span class="o">+</span> <span class="n">coeff1</span><span class="o">*</span><span class="n">v0v1</span>
    <span class="n">MetricVector</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff0</span><span class="o">*</span><span class="p">(</span>    <span class="o">-</span> <span class="n">v1v2</span><span class="p">)</span> <span class="o">+</span> <span class="n">coeff1</span><span class="o">*</span><span class="n">v1v2</span>
    <span class="n">MetricVector</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff0</span><span class="o">*</span><span class="p">(</span>    <span class="o">-</span> <span class="n">v0v2</span><span class="p">)</span> <span class="o">+</span> <span class="n">coeff1</span><span class="o">*</span><span class="n">v0v2</span>
    <span class="n">node</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">MeshingApplication</span><span class="p">.</span><span class="n">METRIC_TENSOR_3D</span><span class="p">,</span> <span class="n">MetricVector</span><span class="p">)</span>

<span class="c1"># We create the remeshing process
</span><span class="n">remesh_param</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Parameters</span><span class="p">(</span><span class="s">"""{ }"""</span><span class="p">)</span>
<span class="n">MmgProcess</span> <span class="o">=</span> <span class="n">MeshingApplication</span><span class="p">.</span><span class="n">MmgProcess3D</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">,</span> <span class="n">remesh_param</span><span class="p">)</span>
<span class="n">MmgProcess</span><span class="p">.</span><span class="n">Execute</span><span class="p">()</span>

<span class="c1"># Finally we export to GiD
</span><span class="kn">from</span> <span class="nn">gid_output_process</span> <span class="kn">import</span> <span class="n">GiDOutputProcess</span>
<span class="n">gid_output</span> <span class="o">=</span> <span class="n">GiDOutputProcess</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">,</span>
                        <span class="s">"gid_output"</span><span class="p">,</span>
                        <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Parameters</span><span class="p">(</span><span class="s">"""
                            {
                                "result_file_configuration" : {
                                    "gidpost_flags": {
                                        "GiDPostMode": "GiD_PostBinary",
                                        "WriteDeformedMeshFlag": "WriteUndeformed",
                                        "WriteConditionsFlag": "WriteConditions",
                                        "MultiFileFlag": "SingleFile"
                                    },        
                                    "nodal_results"       : []
                                }
                            }
                            """</span><span class="p">)</span>
                        <span class="p">)</span>

<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteInitialize</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteBeforeSolutionLoop</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteInitializeSolutionStep</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">PrintOutput</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteFinalizeSolutionStep</span><span class="p">()</span>
<span class="n">gid_output</span><span class="p">.</span><span class="n">ExecuteFinalize</span><span class="p">()</span>   
</code></pre></div></div>

<p><img src="https://github.com/KratosMultiphysics/Examples/raw/master/mmg_remeshing_examples/use_cases/coarse_sphere/data/solution.png" alt="" /></p>

<h2 id="using-the-process">Using the process</h2>

<p>As said before, the re-meshing is based in a process structure, in this case the ‘MainKratos.py’ files must be modified (you can take as reference one present in the next section). The parameters that define this process are the following ones:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">##</span><span class="w"> </span><span class="err">Settings</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">json</span><span class="w"> </span><span class="err">format</span><span class="w">
</span><span class="err">default_parameters</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">KratosMultiphysics.Parameters(</span><span class="s2">"""
{
    "</span><span class="err">mesh_id</span><span class="s2">"                          : 0,
            "</span><span class="err">filename</span><span class="s2">"                         : "</span><span class="err">out</span><span class="s2">",
            "</span><span class="err">model_part_name</span><span class="s2">"                  : "</span><span class="err">MainModelPart</span><span class="s2">",
            "</span><span class="err">strategy</span><span class="s2">"                         : "</span><span class="err">LevelSet</span><span class="s2">",
            "</span><span class="err">level_set_strategy_parameters</span><span class="s2">"              :{
                "</span><span class="err">scalar_variable</span><span class="s2">"                  : "</span><span class="err">DISTANCE</span><span class="s2">",
                "</span><span class="err">gradient_variable</span><span class="s2">"                : "</span><span class="err">DISTANCE_GRADIENT</span><span class="s2">"
            },
            "</span><span class="err">error_strategy_parameters</span><span class="s2">"              :{
                "</span><span class="err">compute_error_extra_parameters</span><span class="s2">":
                {
                    "</span><span class="err">stress_vector_variable</span><span class="s2">"              : "</span><span class="err">CAUCHY_STRESS_VECTOR</span><span class="s2">"
                },
                "</span><span class="err">error_metric_parameters</span><span class="s2">"                 :
                {
                    "</span><span class="err">error_threshold</span><span class="s2">"                       : 0.05,
                    "</span><span class="err">interpolation_error</span><span class="s2">"                   : 0.04
                },
                "</span><span class="err">set_target_number_of_elements</span><span class="s2">"       : false,
                "</span><span class="err">target_number_of_elements</span><span class="s2">"           : 1000,
                "</span><span class="err">perform_nodal_h_averaging</span><span class="s2">"           : false,
                "</span><span class="err">max_iterations</span><span class="s2">"                      : 3
            },
            "</span><span class="err">framework</span><span class="s2">"                            : "</span><span class="err">Eulerian</span><span class="s2">",
            "</span><span class="err">internal_variables_parameters</span><span class="s2">"        :
            {
                "</span><span class="err">allocation_size</span><span class="s2">"                      : 1000,
                "</span><span class="err">bucket_size</span><span class="s2">"                          : 4,
                "</span><span class="err">search_factor</span><span class="s2">"                        : 2,
                "</span><span class="err">interpolation_type</span><span class="s2">"                   : "</span><span class="err">LST</span><span class="s2">",
                "</span><span class="err">internal_variable_interpolation_list</span><span class="s2">" :[]
            },
            "</span><span class="err">hessian_strategy_parameters</span><span class="s2">"              :{
                "</span><span class="err">metric_variable</span><span class="s2">"                  : ["</span><span class="err">DISTANCE</span><span class="s2">"],
                "</span><span class="err">estimate_interpolation_error</span><span class="s2">"     : false,
                "</span><span class="err">interpolation_error</span><span class="s2">"              : 0.04,
                "</span><span class="err">mesh_dependent_constant</span><span class="s2">"          : 0.28125
            },
            "</span><span class="err">enforce_current</span><span class="s2">"                  : true,
            "</span><span class="err">initial_step</span><span class="s2">"                     : 1,
            "</span><span class="err">step_frequency</span><span class="s2">"                   : 0,
            "</span><span class="err">automatic_remesh</span><span class="s2">"                 : true,
            "</span><span class="err">automatic_remesh_parameters</span><span class="s2">"      :{
                "</span><span class="err">automatic_remesh_type</span><span class="s2">"            : "</span><span class="err">Ratio</span><span class="s2">",
                "</span><span class="err">min_size_ratio</span><span class="s2">"                   : 1.0,
                "</span><span class="err">max_size_ratio</span><span class="s2">"                   : 3.0,
                "</span><span class="err">refer_type</span><span class="s2">"                       : "</span><span class="err">Mean</span><span class="s2">",
                "</span><span class="err">min_size_current_percentage</span><span class="s2">"      : 50.0,
                "</span><span class="err">max_size_current_percentage</span><span class="s2">"      : 98.0
            },
            "</span><span class="err">initial_remeshing</span><span class="s2">"                : false,
            "</span><span class="err">fix_contour_model_parts</span><span class="s2">"          : [],
            "</span><span class="err">fix_conditions_model_parts</span><span class="s2">"       : [],
            "</span><span class="err">fix_elements_model_parts</span><span class="s2">"         : [],
            "</span><span class="err">force_min</span><span class="s2">"                        : false,
            "</span><span class="err">minimal_size</span><span class="s2">"                     : 0.1,
            "</span><span class="err">force_max</span><span class="s2">"                        : false,
            "</span><span class="err">maximal_size</span><span class="s2">"                     : 10.0,
            "</span><span class="err">advanced_parameters</span><span class="s2">"                  :
            {
                "</span><span class="err">force_hausdorff_value</span><span class="s2">"               : false,
                "</span><span class="err">hausdorff_value</span><span class="s2">"                     : 0.0001,
                "</span><span class="err">no_move_mesh</span><span class="s2">"                        : false,
                "</span><span class="err">no_surf_mesh</span><span class="s2">"                        : false,
                "</span><span class="err">no_insert_mesh</span><span class="s2">"                      : false,
                "</span><span class="err">no_swap_mesh</span><span class="s2">"                        : false,
                "</span><span class="err">deactivate_detect_angle</span><span class="s2">"             : false,
                "</span><span class="err">force_gradation_value</span><span class="s2">"               : false,
                "</span><span class="err">gradation_value</span><span class="s2">"                     : 1.3
            },
            "</span><span class="err">anisotropy_remeshing</span><span class="s2">"             : true,
            "</span><span class="err">anisotropy_parameters</span><span class="s2">":{
                "</span><span class="err">reference_variable_name</span><span class="s2">"          : "</span><span class="err">DISTANCE</span><span class="s2">",
                "</span><span class="err">hmin_over_hmax_anisotropic_ratio</span><span class="s2">" : 0.01,
                "</span><span class="err">boundary_layer_max_distance</span><span class="s2">"      : 1.0,
                "</span><span class="err">boundary_layer_min_size_ratio</span><span class="s2">"    : 2.0,
                "</span><span class="err">interpolation</span><span class="s2">"                    : "</span><span class="err">Linear</span><span class="s2">"
            },
            "</span><span class="err">save_external_files</span><span class="s2">"              : false,
            "</span><span class="err">max_number_of_searchs</span><span class="s2">"            : 1000,
            "</span><span class="err">interpolate_non_historical</span><span class="s2">"       : true,
            "</span><span class="err">extrapolate_contour_values</span><span class="s2">"       : true,
            "</span><span class="err">search_parameters</span><span class="s2">"                : {
                "</span><span class="err">allocation_size</span><span class="s2">"                  : 1000,
                "</span><span class="err">bucket_size</span><span class="s2">"                      : 4,
                "</span><span class="err">search_factor</span><span class="s2">"                    : 2.0
            },
            "</span><span class="err">debug_mode</span><span class="s2">"                       : false,
            "</span><span class="err">debug_result_mesh</span><span class="s2">"                : false,
            "</span><span class="err">initialize_entities</span><span class="s2">"              : true,
            "</span><span class="err">echo_level</span><span class="s2">"                       : 3
}
"""</span><span class="err">)</span><span class="w">
</span></code></pre></div></div>

<p>The meaning of each of the parameters is the following one:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">output_file_name</code>: This is the name of <code class="language-plaintext highlighter-rouge">*.sol</code> and <code class="language-plaintext highlighter-rouge">*.mesh</code> generated in the case you chose to activate <code class="language-plaintext highlighter-rouge">save_external_files</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">model_part_name</code>: This is important, it should correspond with the name of your actual main model part.</li>
  <li><code class="language-plaintext highlighter-rouge">strategy</code>: The type of strategy to chose, or <code class="language-plaintext highlighter-rouge">LevelSet</code> or <code class="language-plaintext highlighter-rouge">Hessian</code>.</li>
  <li>If you chose the <code class="language-plaintext highlighter-rouge">LevelSet</code> strategy:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">scalar_variable</code>:The scalar variable used to calculate the gradient and remesh.</li>
      <li><code class="language-plaintext highlighter-rouge">gradient_variable</code>: The variable where this gradient will be stored.</li>
    </ul>
  </li>
  <li>If you chose the <code class="language-plaintext highlighter-rouge">Hessian</code> strategy:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">metric_variable</code>: The list of variables that can be considered to calculate the metrics of re-meshing.</li>
      <li><code class="language-plaintext highlighter-rouge">interpolation_error</code>: The interpolation error considered in the re-mesh.</li>
      <li><code class="language-plaintext highlighter-rouge">mesh_dependent_constant</code>: This value is automatically calculated if set to 0, but many definitions can be found in the literature.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">framework</code>: Whatever you want to work “fluids” using <code class="language-plaintext highlighter-rouge">Eulerian</code> or “solids” using <code class="language-plaintext highlighter-rouge">Lagrangian</code>. If you choose <code class="language-plaintext highlighter-rouge">Lagrangian</code> you will need to interpolate the internal variables if you are considering any constitutive model with history (damage or plasticity).
    <ul>
      <li><code class="language-plaintext highlighter-rouge">bucket_size</code>: The size of the bucket used in the tree search.</li>
      <li><code class="language-plaintext highlighter-rouge">allocation_size</code>: The maximum size to allocate the GP used in the search.</li>
      <li><code class="language-plaintext highlighter-rouge">search_factor</code>: The factor that will be used to search near GP, will take the radius of the current element and multiply by this factor.</li>
      <li><code class="language-plaintext highlighter-rouge">internal_variable_interpolation_list</code> : The list containing the internal variables that will be interpolated.</li>
      <li><code class="language-plaintext highlighter-rouge">interpolation_type</code>: There are mainly two ways to interpolate the internal variables (there are three, but just two are behave correctly):
      * <code class="language-plaintext highlighter-rouge">CPT</code>: Closest point transfer. It transfer the values from the closest <strong>GP</strong>
      * <code class="language-plaintext highlighter-rouge">LST</code>: Least-square projection transfer. It transfers from the closest <strong>GP</strong> from the old mesh
      * <code class="language-plaintext highlighter-rouge">SFT</code>: It transfer GP values to the nodes in the old mesh and then interpolate to the new mesh using the shape functions all the time (<strong>NOTE</strong>: THIS DOESN’T WORK PROPERLY, AND REQUIRES EXTRA STORE)</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">enforce_current</code>: If the current size will be enforce as minimum.</li>
  <li><code class="language-plaintext highlighter-rouge">initial_step</code>: The first step to consider to count for the re-meshing.</li>
  <li><code class="language-plaintext highlighter-rouge">step_frequency</code>: The re-mesh will be performed each this number of steps.</li>
  <li><code class="language-plaintext highlighter-rouge">automatic_remesh</code>: If to re-mesh according ratios or manually.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">automatic_remesh_type</code>: If the automatic re-meshed is performed according a ratio or statistically</li>
      <li><code class="language-plaintext highlighter-rouge">min_size_ratio</code>: The proportional ratio of the minimum respect the mean or median <code class="language-plaintext highlighter-rouge">NODAL_H</code></li>
      <li><code class="language-plaintext highlighter-rouge">max_size_ratio</code>: The proportional ratio of the maximum respect the mean or median <code class="language-plaintext highlighter-rouge">NODAL_H</code></li>
      <li><code class="language-plaintext highlighter-rouge">refer_type</code>: This can be chosen between the mean or the median, the mean is the default value.</li>
      <li><code class="language-plaintext highlighter-rouge">min_size_current_percentage</code>: When the minimum size is defined statistically, this is the minimum size percentile</li>
      <li><code class="language-plaintext highlighter-rouge">max_size_current_percentage</code>: When the maximum size is defined statistically, this is the maximum size percentile</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">advanced_parameters</code>  : These are advanced <em>MMG</em> parameters
    <ul>
      <li><code class="language-plaintext highlighter-rouge">force_hausdorff_value</code>:  If the <em>Hausdorff</em> is set. This parameter controls the smoothness of the contour</li>
      <li><code class="language-plaintext highlighter-rouge">hausdorff_value</code>: Global <em>Hausdorff</em> value (default value = 0.01) applied on the whole boundary</li>
      <li><code class="language-plaintext highlighter-rouge">no_move_mesh</code>: Avoid/allow point relocation</li>
      <li><code class="language-plaintext highlighter-rouge">no_surf_mesh</code>: Avoid/allow surface modifications</li>
      <li><code class="language-plaintext highlighter-rouge">no_insert_mesh</code>: Don’t insert nodes on mesh</li>
      <li><code class="language-plaintext highlighter-rouge">no_swap_mesh</code>: Don’t swap mesh</li>
      <li><code class="language-plaintext highlighter-rouge">deactivate_detect_angle</code>: Set the angle detection as activated</li>
      <li><code class="language-plaintext highlighter-rouge">force_gradation_value</code>:  If the gradation of the mesh will be enforced</li>
      <li><code class="language-plaintext highlighter-rouge">gradation_value</code> : Set the gradation</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">initial_remeshing</code>: If to perform some remeshing in the initialization process</li>
  <li><code class="language-plaintext highlighter-rouge">fix_contour_model_parts</code>: This is a list with the submodelparts of the contour where you desire to fix the nodes.</li>
  <li><code class="language-plaintext highlighter-rouge">fix_conditions_model_parts</code> : The same, but applied for conditions</li>
  <li><code class="language-plaintext highlighter-rouge">fix_elements_model_parts</code> : Idem, but in this case for elements</li>
  <li><code class="language-plaintext highlighter-rouge">minimal_size</code>: When the minimum size is specified manually</li>
  <li><code class="language-plaintext highlighter-rouge">maximal_size</code>: When the maximum size is specified manually</li>
  <li><code class="language-plaintext highlighter-rouge">anisotropy_remeshing</code>: If the anisotropy should be considered in the computation of the remeshing
    <ul>
      <li><code class="language-plaintext highlighter-rouge">hmin_over_hmax_anisotropic_ratio</code>: The minimal anisotropic ratio considered (<strong>NOTE</strong>: 0 is the maximum value of anisotropy, 1  is not anisotropic at all)</li>
      <li><code class="language-plaintext highlighter-rouge">boundary_layer_max_distance</code>: When the threshold value is specified manually</li>
      <li><code class="language-plaintext highlighter-rouge">boundary_layer_min_size_ratio</code>: When the threshold value is specified using a ratio of reference</li>
      <li><code class="language-plaintext highlighter-rouge">interpolation</code>: The interpolation algorithm used in the anisotropic area. By default is linear, which means that is increasing until the value to the reference is zero.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">save_external_files</code>: This activates the saving of the resulting meshes (in <code class="language-plaintext highlighter-rouge">*.mesh</code> and <code class="language-plaintext highlighter-rouge">*.sol</code> files)</li>
  <li><code class="language-plaintext highlighter-rouge">max_number_of_searchs</code>: This is the max. number of search that can be done in the value interpolation process (when values are interpolated from the old mesh to the new mesh)</li>
  <li><code class="language-plaintext highlighter-rouge">debug_mode</code>: If true will output a <em>GiD</em> file with just after each remesh (could be useful to check if the error is in the generated mesh).</li>
  <li><code class="language-plaintext highlighter-rouge">echo_level</code>: This sets the <code class="language-plaintext highlighter-rouge">echo_level</code>, 0 for no output at all, 3 for standard output.</li>
</ul>

<p>Can you show us a little example?</p>

<p>Of course, in the <a href="https://github.com/KratosMultiphysics/Examples/tree/master/mmg_remeshing_examples">examples repository</a> you can find some examples using the process that you can run in your machine.</p>

<p><a href="https://github.com/KratosMultiphysics/Examples/tree/master/mmg_remeshing_examples/use_cases/channel_sphere2D">This problem</a> consists in a 2D fluid problem with continuous re-meshing using the Hessian of the velocity as reference. The resulting output should look something similar to the <a href="https://www.youtube.com/watch?v=Yd57qxtnNFk&amp;feature=youtu.be">this</a>.</p>

<p><img src="https://github.com/KratosMultiphysics/Examples/blob/master/mmg_remeshing_examples/use_cases/channel_sphere2D/data/result.gif" alt="" /></p>

<p><a href="https://github.com/KratosMultiphysics/Examples/tree/master/mmg_remeshing_examples/use_cases/channel_sphere3D">The same case in 3D</a>. The resulting output should look something similar to the <a href="https://youtu.be/HVNa5O6h4wM">this</a>.</p>

<p><img src="https://github.com/KratosMultiphysics/Examples/blob/master/mmg_remeshing_examples/use_cases/channel_sphere3D/data/result.gif" alt="" /></p>

<p>The problems presented in the tests can be used as reference too.</p>


    <!-- <div class="tags">
        
        <b>Tags: </b>
        
        
        
        
        
    </div> -->

</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2022 CIMNE. All rights reserved. <br />
 Site last generated: Dec 30, 2022 <br />
<p style="padding-right:32px;"><br><img src="/images/company_logo.png" alt="Company logo" height="100px"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
