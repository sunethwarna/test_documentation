<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="Checking-memory-usage-with-Valgrind.md,  ">

<title>Checking memory usage with Valgrind | Kratos Multiphysics Documentation</title>

<link rel="stylesheet" href="/css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/modern-business.css">

<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/customstyles.css">
<link rel="stylesheet" href="/css/boxshadowproperties.css">

<!-- Most color styles are extracted out to here -->
<link rel="stylesheet" href="/css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<!-- MathJax.js -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script src="/js/toc.js"></script>
<script src="/js/customscripts.js"></script>

<link rel="shortcut icon" href="/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/">&nbsp;<span class="projectTitle"> Kratos Multiphysics Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/KratosMultiphysics/Kratos" target="_blank" rel="noopener">GitHub</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Kratos<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Kratos/For_Users/General/Overview.html">For Users</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/For_Developers/General/Application-Cases.html">For Developers</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Processes/General/Overview.html">Processes</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Utilities/General/Overview.html">Utilities</a></li>
                        
                        
                        
                        <li class="dropdownActive"><a href="/pages/Kratos/Debugging/General/Checking-memory-usage-with-Valgrind.html">Debugging</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Documentation_Guide/General/Overview.html">Documentation Guide</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Workshops/2019/running_an_example_from_GiD.html">Workshops</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Applications<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Applications/Discrete_Element_Modelling_Application/General/Basic-DEM-Benchmarking.html">Discrete Element Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid-Structure_Interaction_Application/General/2D-Mok-benchmark.html">Fluid-Structure Interaction Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid_Dynamics_Application/General/2D-Cavity-flow-problem.html">Fluid Dynamics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Mapping_Application/General/How-to-do-Mapping-between-nonmatching-meshes.html">Mapping Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Meshing_Application/General/Utilities-MMG-Process.html">Meshing Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Particle_Mechanics_Application/General/Overview.html">Particle Mechanics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Reduced_Order_Modelling_Application/General/API-for-RomApplication-(draft-to-be-moved-elsewhere).html">Reduced Order Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Statistics_Application/General/Overview.html">Statistics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Structural_Mechanics_Application/General/0_Roll-up-beam-cantilever.html">Structural Mechanics Application</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:kratosmultiphysics@gmail.com?subject=Kratos Multiphysics Documentation feedback&body=I have some feedback about the Checking memory usage with Valgrind page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: '/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Checking memory usage with Valgrind">{title}</a></li>',
                    noResultsText: '',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Debugging </li>
  
  
  
  <li>
      <a title="General" href="#">General</a>
      <ul>
          
          
          
          <li class="active"><a title="Checking memory usage with Valgrind" href="/pages/Kratos/Debugging/General/Checking-memory-usage-with-Valgrind.html">Checking memory usage with Valgrind</a></li>
          
          
          
          
          
          
          <li><a title="Debug Memory Using ASAN" href="/pages/Kratos/Debugging/General/Debug-Memory-Using-ASAN.html">Debug Memory Using ASAN</a></li>
          
          
          
          
          
          
          <li><a title="Debugging Kratos using GDB" href="/pages/Kratos/Debugging/General/Debugging-Kratos-using-GDB.html">Debugging Kratos using GDB</a></li>
          
          
          
          
          
          
          <li><a title="Debugging Kratos using Visual Studio" href="/pages/Kratos/Debugging/General/Debugging-Kratos-using-Visual-Studio.html">Debugging Kratos using Visual Studio</a></li>
          
          
          
          
          
          
          <li><a title="How to cross debug Kratos under Windows" href="/pages/Kratos/Debugging/General/How-to-cross-debug-Kratos-under-Windows.html">How to cross debug Kratos under Windows</a></li>
          
          
          
          
          
          
          <li><a title="How to profile Kratos using MAQAO" href="/pages/Kratos/Debugging/General/How-to-profile-Kratos-using-MAQAO.html">How to profile Kratos using MAQAO</a></li>
          
          
          
          
          
          
          <li><a title="Profiling Kratos with LineProfile" href="/pages/Kratos/Debugging/General/Profiling-Kratos-with-LineProfile.html">Profiling Kratos with LineProfile</a></li>
          
          
          
          
          
          
          <li><a title="Profiling Kratos with cProfile and VTune" href="/pages/Kratos/Debugging/General/Profiling Kratos with cProfile and VTune.html">Profiling Kratos with cProfile and VTune</a></li>
          
          
          
          
          
          
          <li><a title="Serialization" href="/pages/Kratos/Debugging/General/How-to-use-Serialization.html">Serialization</a></li>
          
          
          
          
          
          
          <li><a title="Thread Sanitizer" href="/pages/Kratos/Debugging/General/thread-sanitizer.html">Thread Sanitizer</a></li>
          
          
          
          
      </ul>
  </li>
  
  
  
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Checking memory usage with Valgrind</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" rel="noopener" href="https://github.com/KratosMultiphysics/Kratos/tree/master/docs/pages/Kratos/Debugging/General/Checking-memory-usage-with-Valgrind.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

   <h2 id="introduction">Introduction</h2>

<p>This page describes the basic usage of <em>Valgrind</em>, a debugging and profiling tool that keeps track of the memory used by your code. <em>Valgrind</em> runs on Linux systems, and can be obtained from the repository of some distributions (e.g. Ubuntu). Its official documentation can be found in http://valgrind.org/</p>

<h2 id="finding-memory-errors-with-memcheck">Finding memory errors with Memcheck</h2>

<p><em>Valgrind</em>’s Memcheck tool is useful to look for unexpected access to the memory, which are likely related to bugs in your code. Typical examples of bugs that produce memory errors are writing past the end of an std::vector or wrong uses of pointers. To use Memcheck on your code, compile it (preferably in debug, as the output will be more detailed) and run it using</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind python your_script.py
</code></pre></div></div>

<p>You will probably want to redirect the output to a file or (better yet) run it from emacs using the compile option, as the program generates a lot of output and will quickly fill the terminal’s buffer. Note that you will likely find multiple errors that are not directly related to your code. Fortunately, <em>Valgrind</em> records the file and line the error generates from. You should be concerned by errors generated by your code or in functions called from your code. To help filter unwanted messages, the –suppressions option can be used, which hides all the errors of the types defined in a suppression file.</p>

<p>Both Python and OpenMPI trigger warning messages from Memcheck, which can be suppressed using suppression files provided in your installation. Assuming the default install folders in Ubuntu, you can suppress their errors running <em>Valgrind</em> as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   valgrind --suppressions=/usr/lib/valgrind/python.supp python your_script.py
</code></pre></div></div>

<p>for Python and:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mpirun -np 2 valgrind --suppressions=/usr/lib/valgrind/python.supp --suppressions=/usr/local/share/openmpi/openmpi-valgrind.supp python your_script.py
</code></pre></div></div>

<p>Additionally, you can get a more detailed output if you call <em>Valgrind</em> with the flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  --leak-check=full
</code></pre></div></div>

<h2 id="analysing-memory-use-with-massif">Analysing memory use with Massif</h2>

<p>Another useful tool included in <em>Valgrind</em> is Massif, which provides a detailed analysis of the use of memory during the program’s execution. Compile your code and run it using:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind --tool=massif python your_script.py
</code></pre></div></div>

<p>Once the execution is finished, <em>Valgrind</em> will generate an output file called massif.out.XXXX (where XXXX is your process’ id) that registers the memory used by the code at different times, organized by the object (and line of code) that wrote it. This file is typically large and using it directly is impractical, but fortunately there are tools that can be used to present it in a graphical form. One of such tools is <em>massif-visualiser</em>, which can be installed in <em>Debian</em> and derived distributions with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install massif-visualiser
</code></pre></div></div>

<p>Massiftool can read a Massif output file and displays a graphical version of its contents.</p>

<ul>
  <li>
    <p>On the top left window, the different detailed snapshots are shown. Each snapshot is a record of the memory used by your program at a given moment. Clicking on a snapshot will display it on the right window.</p>
  </li>
  <li>
    <p>On the top right window, you can see the contents of a given snapshot. The top lines display general information, including total memory use. The following lines provide a detailed description of the memory used, recording the object that occupied it. Each entry in a snapshot can be unfolded clicking on the + symbol, which will display additional details. Clicking on an entry will produce a graph on the bottom window, which displays its evolution along the different snapshots.</p>
  </li>
  <li>
    <p>The bottom window displays a graph that shows the time evolution of the item selected in the top right window.</p>
  </li>
</ul>

<p>A typical massif output, displayed using <em>massif-visualiser</em>, can be seen in the following screenshot:</p>

<p><img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/Checking_memory_use_with_Valgrind/massif.png" alt="" /></p>



    <!-- <div class="tags">
        
        <b>Tags: </b>
        
        
        
        
        
    </div> -->

</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2022 CIMNE. All rights reserved. <br />
 Site last generated: Dec 30, 2022 <br />
<p style="padding-right:32px;"><br><img src="/images/company_logo.png" alt="Company logo" height="100px"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
