<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="Constitutive Law Tutorial C++,  ">

<title>Constitutive Law | Kratos Multiphysics Documentation</title>

<link rel="stylesheet" href="/css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/modern-business.css">

<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/customstyles.css">
<link rel="stylesheet" href="/css/boxshadowproperties.css">

<!-- Most color styles are extracted out to here -->
<link rel="stylesheet" href="/css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<!-- MathJax.js -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script src="/js/toc.js"></script>
<script src="/js/customscripts.js"></script>

<link rel="shortcut icon" href="/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/">&nbsp;<span class="projectTitle"> Kratos Multiphysics Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/KratosMultiphysics/Kratos" target="_blank" rel="noopener">GitHub</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Kratos<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Kratos/For_Users/General/Overview.html">For Users</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/For_Developers/General/Application-Cases.html">For Developers</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Processes/General/Overview.html">Processes</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Utilities/General/Overview.html">Utilities</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Debugging/General/Checking-memory-usage-with-Valgrind.html">Debugging</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Documentation_Guide/General/Overview.html">Documentation Guide</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Workshops/2019/running_an_example_from_GiD.html">Workshops</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Applications<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Applications/Discrete_Element_Modelling_Application/General/Basic-DEM-Benchmarking.html">Discrete Element Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid-Structure_Interaction_Application/General/2D-Mok-benchmark.html">Fluid-Structure Interaction Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid_Dynamics_Application/General/2D-Cavity-flow-problem.html">Fluid Dynamics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Mapping_Application/General/How-to-do-Mapping-between-nonmatching-meshes.html">Mapping Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Meshing_Application/General/Utilities-MMG-Process.html">Meshing Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Particle_Mechanics_Application/General/Overview.html">Particle Mechanics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Reduced_Order_Modelling_Application/General/API-for-RomApplication-(draft-to-be-moved-elsewhere).html">Reduced Order Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Statistics_Application/General/Overview.html">Statistics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Structural_Mechanics_Application/General/0_Roll-up-beam-cantilever.html">Structural Mechanics Application</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:kratosmultiphysics@gmail.com?subject=Kratos Multiphysics Documentation feedback&body=I have some feedback about the Constitutive Law page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: '/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Constitutive Law">{title}</a></li>',
                    noResultsText: '',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">For Developers </li>
  
  
  
  <li>
      <a title="General" href="#">General</a>
      <ul>
          
          
          
          <li><a title="Adding dynamic contributions to the element file" href="/pages/Kratos/For_Developers/General/Tutorial-Adding-dynamic-contributions-to-the-element-file.html">Adding dynamic contributions to the element file</a></li>
          
          
          
          
          
          
          <li><a title="Adjoint API" href="/pages/Kratos/For_Developers/General/Adjoint-API.html">Adjoint API</a></li>
          
          
          
          
          
          
          <li><a title="Analysis stage for pure diffusion problem" href="/pages/Kratos/For_Developers/General/Tutorial-Analysis-stage-for-pure-diffusion-problem.html">Analysis stage for pure diffusion problem</a></li>
          
          
          
          
          
          
          <li><a title="Application Cases" href="/pages/Kratos/For_Developers/General/Application-Cases.html">Application Cases</a></li>
          
          
          
          
          
          
          <li><a title="Applications as python modules" href="/pages/Kratos/For_Developers/General/Applications-as-python-modules.html">Applications as python modules</a></li>
          
          
          
          
          
          
          <li><a title="Applying periodic boundary conditions" href="/pages/Kratos/For_Developers/General/Applying-periodic-boundary-conditions.html">Applying periodic boundary conditions</a></li>
          
          
          
          
          
          
          <li><a title="Authorship of Kratos files" href="/pages/Kratos/For_Developers/General/Authorship-of-Kratos-files.html">Authorship of Kratos files</a></li>
          
          
          
          
          
          
          <li><a title="Clang Tidy to automatically correct code" href="/pages/Kratos/For_Developers/General/How-to-use-Clang-Tidy-to-automatically-correct-code.html">Clang Tidy to automatically correct code</a></li>
          
          
          
          
          
          
          <li><a title="Common Python Interface of Applications for Users" href="/pages/Kratos/For_Developers/General/Common-Python-Interface-of-Applications-for-Users.html">Common Python Interface of Applications for Users</a></li>
          
          
          
          
          
          
          <li class="active"><a title="Constitutive Law" href="/pages/Kratos/For_Developers/General/How-to-use-the-Constitutive-Law-class.html">Constitutive Law</a></li>
          
          
          
          
          
          
          <li><a title="Cotire" href="/pages/Kratos/For_Developers/General/How-to-use-Cotire.html">Cotire</a></li>
          
          
          
          
          
          
          <li><a title="Creating a wrapper of convergence criteria" href="/pages/Kratos/For_Developers/General/Tutorial-Creating-a-wrapper-of-convergence-criteria.html">Creating a wrapper of convergence criteria</a></li>
          
          
          
          
          
          
          <li><a title="Creating an Utility" href="/pages/Kratos/For_Developers/General/Tutorial-Creating-an-Utility.html">Creating an Utility</a></li>
          
          
          
          
          
          
          <li><a title="Creating the Conditions" href="/pages/Kratos/For_Developers/General/Tutorial-Creating-the-Conditions.html">Creating the Conditions</a></li>
          
          
          
          
          
          
          <li><a title="Creating the Element" href="/pages/Kratos/For_Developers/General/Tutorial-Creating-the-Element.html">Creating the Element</a></li>
          
          
          
          
          
          
          <li><a title="Creating the Python Solver file" href="/pages/Kratos/For_Developers/General/Tutorial-Creating-the-Python-Solver-file.html">Creating the Python Solver file</a></li>
          
          
          
          
          
          
          <li><a title="Data management" href="/pages/Kratos/For_Developers/General/Data-management.html">Data management</a></li>
          
          
          
          
          
          
          <li><a title="Editing the main files" href="/pages/Kratos/For_Developers/General/Tutorial-Editing-the-main-files.html">Editing the main files</a></li>
          
          
          
          
          
          
          <li><a title="How to Access DataBase" href="/pages/Kratos/For_Developers/General/How-to-Access-DataBase.html">How to Access DataBase</a></li>
          
          
          
          
          
          
          <li><a title="How to apply a function to a list of variables" href="/pages/Kratos/For_Developers/General/How-to-apply-a-function-to-a-list-of-variables.html">How to apply a function to a list of variables</a></li>
          
          
          
          
          
          
          <li><a title="How to configure clang‐format" href="/pages/Kratos/For_Developers/General/How-to-configure-clang‐format.html">How to configure clang‐format</a></li>
          
          
          
          
          
          
          <li><a title="How to create unitary tests" href="/pages/Kratos/For_Developers/General/How-to-create-unitary-tests.html">How to create unitary tests</a></li>
          
          
          
          
          
          
          <li><a title="How to generate python wheels" href="/pages/Kratos/For_Developers/General/How-to-generate-python-wheels.html">How to generate python wheels</a></li>
          
          
          
          
          
          
          <li><a title="How to make Git ignore the files resulting from a compilation without conflicts in .gitignore" href="/pages/Kratos/For_Developers/General/How-to-make-Git-ignore-the-files-resulting-from-a-compilation-without-conflicts-in-.gitignore.html">How to make Git ignore the files resulting from a compilation without conflicts in .gitignore</a></li>
          
          
          
          
          
          
          <li><a title="How to run multiple cases using PyCOMPSs" href="/pages/Kratos/For_Developers/General/How-to-run-multiple-cases-using-PyCOMPSs.html">How to run multiple cases using PyCOMPSs</a></li>
          
          
          
          
          
          
          <li><a title="KRATOS_API for Windows Compilation" href="/pages/Kratos/For_Developers/General/KRATOS_API-for-Windows-Compilation.html">KRATOS_API for Windows Compilation</a></li>
          
          
          
          
          
          
          <li><a title="Kratos classes accesible via python" href="/pages/Kratos/For_Developers/General/Kratos-classes-accesible-via-python.html">Kratos classes accesible via python</a></li>
          
          
          
          
          
          
          <li><a title="Kratos input files and I O" href="/pages/Kratos/For_Developers/General/Kratos-input-files-and-I-O.html">Kratos input files and I O</a></li>
          
          
          
          
          
          
          <li><a title="Kratos input files and IO" href="/pages/Kratos/For_Developers/General/Kratos-input-files-and-IO.html">Kratos input files and IO</a></li>
          
          
          
          
          
          
          <li><a title="KratosAPI MultiPoint Constraint (MPC) interface" href="/pages/Kratos/For_Developers/General/MultiPoint-Constraint-interface.html">KratosAPI MultiPoint Constraint (MPC) interface</a></li>
          
          
          
          
          
          
          <li><a title="Local axes orientation" href="/pages/Kratos/For_Developers/General/Local-axes-orientation.html">Local axes orientation</a></li>
          
          
          
          
          
          
          <li><a title="Logger" href="/pages/Kratos/For_Developers/General/How-to-use-Logger.html">Logger</a></li>
          
          
          
          
          
          
          <li><a title="Manipulating solution values" href="/pages/Kratos/For_Developers/General/Manipulating-solution-values.html">Manipulating solution values</a></li>
          
          
          
          
          
          
          <li><a title="Mesh node ordering" href="/pages/Kratos/For_Developers/General/Mesh-node-ordering.html">Mesh node ordering</a></li>
          
          
          
          
          
          
          <li><a title="ModelPart and SubModelPart" href="/pages/Kratos/For_Developers/General/ModelPart-and-SubModelPart.html">ModelPart and SubModelPart</a></li>
          
          
          
          
          
          
          <li><a title="ModelPart entities" href="/pages/Kratos/For_Developers/General/ModelPart-entities.html">ModelPart entities</a></li>
          
          
          
          
          
          
          <li><a title="Nodes and Nodal Data" href="/pages/Kratos/For_Developers/General/Nodes-and-Nodal-Data.html">Nodes and Nodal Data</a></li>
          
          
          
          
          
          
          <li><a title="Parallel Utilities" href="/pages/Kratos/For_Developers/General/Parallel-Utilities.html">Parallel Utilities</a></li>
          
          
          
          
          
          
          <li><a title="PointerCommunicator" href="/pages/Kratos/For_Developers/General/How-to-use-PointerCommunicator.html">PointerCommunicator</a></li>
          
          
          
          
          
          
          <li><a title="PointerMapCommunicator" href="/pages/Kratos/For_Developers/General/How-to-use-PointerMapCommunicator.html">PointerMapCommunicator</a></li>
          
          
          
          
          
          
          <li><a title="Porting to AMatrix" href="/pages/Kratos/For_Developers/General/Porting-to-AMatrix.html">Porting to AMatrix</a></li>
          
          
          
          
          
          
          <li><a title="Porting to PyBind11   common steps" href="/pages/Kratos/For_Developers/General/Porting-to-PyBind11-common-steps.html">Porting to PyBind11   common steps</a></li>
          
          
          
          
          
          
          <li><a title="Processes In the application of BCs" href="/pages/Kratos/For_Developers/General/How-to-use-Processes-In-the-application-of-BCs.html">Processes In the application of BCs</a></li>
          
          
          
          
          
          
          <li><a title="Pure diffusion solver derived from main python solver" href="/pages/Kratos/For_Developers/General/Tutorial-Pure-diffusion-solver-derived-from-main-python-solver.html">Pure diffusion solver derived from main python solver</a></li>
          
          
          
          
          
          
          <li><a title="Quaternions in Kratos" href="/pages/Kratos/For_Developers/General/How-to-use-quaternions-in-Kratos.html">Quaternions in Kratos</a></li>
          
          
          
          
          
          
          <li><a title="Smart Pointers within Kratos" href="/pages/Kratos/For_Developers/General/How-to-use-Smart-Pointers-within-Kratos.html">Smart Pointers within Kratos</a></li>
          
          
          
          
          
          
          <li><a title="Solving strategies" href="/pages/Kratos/For_Developers/General/Solving-strategies.html">Solving strategies</a></li>
          
          
          
          
          
          
          <li><a title="Sparse Linear Algebra (native Kratos implementation)" href="/pages/Kratos/For_Developers/General/Sparse-Linear-Algebra-(native-Kratos-implementation).html">Sparse Linear Algebra (native Kratos implementation)</a></li>
          
          
          
          
          
          
          <li><a title="Style Guide" href="/pages/Kratos/For_Developers/General/Style-Guide.html">Style Guide</a></li>
          
          
          
          
          
          
          <li><a title="Using alias for Ublas matrix and vector" href="/pages/Kratos/For_Developers/General/Using-alias-for-Ublas-matrix-and-vector.html">Using alias for Ublas matrix and vector</a></li>
          
          
          
          
          
          
          <li><a title="Using processes to customize a simulation" href="/pages/Kratos/For_Developers/General/Using-processes-to-customize-a-simulation.html">Using processes to customize a simulation</a></li>
          
          
          
          
          
          
          <li><a title="Utilities Colors utility" href="/pages/Kratos/For_Developers/General/Utilities-Colors-utility.html">Utilities Colors utility</a></li>
          
          
          
          
          
          
          <li><a title="Windows Install" href="/pages/Kratos/For_Developers/General/Windows-Install.html">Windows Install</a></li>
          
          
          
          
          
          
          <li><a title="Windows Install (MinGW)" href="/pages/Kratos/For_Developers/General/Windows-Install-(MinGW).html">Windows Install (MinGW)</a></li>
          
          
          
          
          
          
          <li><a title="the FEAST Solver in Kratos?" href="/pages/Kratos/For_Developers/General/How-to-use-the-FEAST-Solver-in-Kratos.html">the FEAST Solver in Kratos?</a></li>
          
          
          
          
          
          
          <li><a title="the Geometry" href="/pages/Kratos/For_Developers/General/How-to-use-the-Geometry.html">the Geometry</a></li>
          
          
          
          
          
          
          <li><a title="the PaStiX solver in Kratos" href="/pages/Kratos/For_Developers/General/How-to-use-the-PaStiX-solver-in-Kratos.html">the PaStiX solver in Kratos</a></li>
          
          
          
          
      </ul>
  </li>
  
  
  
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Constitutive Law</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" rel="noopener" href="https://github.com/KratosMultiphysics/Kratos/tree/master/docs/pages/Kratos/For_Developers/General/How-to-use-the-Constitutive-Law-class.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

   <h2 id="introduction">Introduction</h2>

<p>The constitutive law behaviour is dealt with in kratos by the use of the class “ConstitutiveLaw”, 
with a public interface defined in the file
   kratos/kratos/includes/constitutive_law.h
which also provides some rather extensive inline documentation (in the form of comments in the code).</p>

<p>By design such file aims to provide a very flexible interface to constitutive law modelling, with the specific goal of 
‘'’maximizing the flexibility in the implementation of complex constitutive behaviours’’’. While such approach provide obvious advantages, it 
also implies that the API is more complex than what would be strictly needed for very simple constitutive laws.</p>

<p>The objective of current HowTo is to provide a brief introduction to the interface</p>

<h3 id="conventions">Conventions</h3>
<p>Through the whole section, the following convenctions will be employed:</p>

<p>'’voigt notation:’’</p>

<ul>
  <li>
    <p>3D case:
STRAIN Voigt Notation:  e00 e11 e22 2<em>e01 2</em>e12 2*e02
STRESS Voigt Notation:  s00 s11 s22   s01   s12   s02</p>
  </li>
  <li>
    <p>2D plane strain/axisymmetric case (4 stress components)
STRAIN Voigt Notation:  e00 e11 e22 2*e01 
STRESS Voigt Notation:  s00 s11 s22   s01</p>
  </li>
  <li>
    <p>2D plane stress/strain
STRAIN Voigt Notation:  e00 e11 2*e01 
STRESS Voigt Notation:  s00 s11   s01</p>
  </li>
</ul>

<p>The constitutive law works on the basis of the ‘'’total deformation gradient F’’’, defined as</p>

<p>F  := D(X) / D(X0)</p>

<p>that is, as the deformation gradient connecting the original and deformed configuration</p>

<p>where the initial position X0 is the one obtained by</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">array_1d</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="mi">3</span><span class="o">&gt;&amp;</span> <span class="n">X0</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">GetInitialPosition</span><span class="p">()</span>
</code></pre></div></div>

<p>and the deformed one by</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">array_1d</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="mi">3</span><span class="o">&gt;&amp;</span> <span class="n">X</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">Coordinates</span><span class="p">()</span> 
<span class="c1">//must coincide with      X = node-&gt;GetInitialPosition() + node.FastGetSolutionStepValue(DISPLACEMENT);</span>
</code></pre></div></div>

<p>The ConstitutiveLaw ‘'’always returns the total stress’’’. Formulations expressed in terms of strain increments shall store internally the strain stresses from which the increment
shall be computed</p>

<h2 id="usage-api">Usage API</h2>
<p>The constitutive law API is based on the use of an auxiliary “Parameters” data structure, designed to encapsulate the data to be passed to the CL and received from it.
The parameters data structure should be initialized using the following constructor:</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Parameters</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">GeometryType</span><span class="o">&amp;</span> <span class="n">rElementGeometry</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">Properties</span><span class="o">&amp;</span> <span class="n">rMaterialProperties</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">ProcessInfo</span><span class="o">&amp;</span> <span class="n">rCurrentProcessInfo</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Thus allowing to encapsulate the pointer to the elemental properties, to the element geometry and to the process info.</p>

<p>The data structure ‘'’does not contain any internal storage’’’ and should be initialized with pointers to memory ‘‘owned by the caller element’’. 
Full documentation of the code can be found in the file constitutive_law.h (https://github.com/KratosMultiphysics/Kratos/blob/feature-clean-claw-flags/kratos/includes/constitutive_law.h).
For ease, the getter interface, ‘‘returning a reference to the encapsulated data’’, is reported here</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GetOptions</span><span class="p">()</span> <span class="c1">// Returns a reference to a flag container, to be employed in passing options to the CL</span>
<span class="n">GetDeterminantF</span><span class="p">()</span>   
<span class="n">GetDeformationGradientF</span><span class="p">()</span> 
<span class="n">GetShapeFunctionsValues</span><span class="p">()</span> 
<span class="n">GetShapeFunctionsDerivatives</span><span class="p">()</span> 
<span class="n">GetStrainVector</span><span class="p">()</span> <span class="c1">// INPUT/OUTPUT -- note that F will be used preferentially instead of the input strain</span>
<span class="n">GetStressVector</span><span class="p">()</span> 
<span class="n">GetConstitutiveMatrix</span><span class="p">()</span> 
<span class="n">GetProcessInfo</span><span class="p">()</span> 
<span class="n">GetMaterialProperties</span><span class="p">()</span> 
<span class="n">GetElementGeometry</span><span class="p">()</span>
</code></pre></div></div>

<p>The “Options” flag represents the fundamental tool in steering the control of the constitutive law behaviour. The interface provides a number of boolean flags that can be passed to the constitutive law:</p>

<p>’'’fundamental flags’’’: these are flags that most users will need to employ in everydays usage</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">USE_ELEMENT_PROVIDED_STRAIN</span> <span class="c1">// (only valid in small strain or for rate form </span>
                            <span class="c1">//  note that when employed large strain CLs can not be used)</span>
<span class="n">COMPUTE_STRESS</span>
<span class="n">COMPUTE_CONSTITUTIVE_TENSOR</span>
</code></pre></div></div>

<p>The results of the computations done employing such flags is returned through the data, and can be calling the functions <code class="language-plaintext highlighter-rouge">GetStressVector()</code> and <code class="language-plaintext highlighter-rouge">GetConstitutiveMatrix()</code> respectively.</p>

<p>’'’optional flags’’’:
these are flags that provide fine tuning in the expected behaviour of the CL. However they are ‘'’strictly optional’’’, in the sense that ‘'’many constitutive laws may not implement them.’’’</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ISOCHORIC_TENSOR_ONLY</span>      
<span class="n">VOLUMETRIC_TENSOR_ONLY</span> 
<span class="n">MECHANICAL_RESPONSE_ONLY</span>
<span class="n">THERMAL_RESPONSE_ONLY</span>   
</code></pre></div></div>

<p>The element should check if the feature is available (that is, if the CL provides the feature) in the Check function of the element</p>

<p>’'’internal flags’’’
These are flags that are useful for computation internally to the CL. ‘'’they should NOT be used by the element’’’</p>
<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INITIALIZE_MATERIAL_RESPONSE</span>
<span class="n">FINALIZE_MATERIAL_RESPONSE</span>
</code></pre></div></div>

<h2 id="stressstrain-measures">STRESS/STRAIN MEASURES</h2>

<p>A fundamental feature of the constitutive law is to implement internally the transformations between different stress measures. 
When a user writes an element he should decide what
stress measure is desired. The list of available options is provided in the enum:</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="n">StressMeasure</span>
<span class="p">{</span>
    <span class="n">StressMeasure_PK1</span><span class="p">,</span>            <span class="c1">//stress related to reference configuration non-symmetric</span>
    <span class="n">StressMeasure_PK2</span><span class="p">,</span>            <span class="c1">//stress related to reference configuration</span>
    <span class="n">StressMeasure_Kirchhoff</span><span class="p">,</span>      <span class="c1">//stress related to current   configuration</span>
    <span class="n">StressMeasure_Cauchy</span>          <span class="c1">//stress related to current   configuration</span>
<span class="p">}</span>
</code></pre></div></div>

<p>at the moment of writing the element the developer should hence query to the constitutive law for the desired stress measure. This is achieved by picking
one of the functions:</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CalculateMaterialResponsePK1</span><span class="p">(</span> <span class="n">parameters</span> <span class="p">)</span>
<span class="n">CalculateMaterialResponsePK2</span><span class="p">(</span> <span class="n">parameters</span> <span class="p">)</span>
<span class="n">CalculateMaterialResponseKirchhoff</span><span class="p">(</span> <span class="n">parameters</span> <span class="p">)</span>
<span class="n">CalculateMaterialResponseCauchy</span><span class="p">(</span> <span class="n">parameters</span> <span class="p">)</span>
</code></pre></div></div>

<p>the elasticity tensor and the corresponding stresses will be stored in the “parameters” and shall be accessed by the Getter functions described above.</p>

<p>At the end of a given solution step (typically in the FinalizeSolutionStep function of the element), internal variables should be updated by calling the function</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FinalizeMaterialResponsePK1</span><span class="p">(</span> <span class="n">parameters</span> <span class="p">)</span>
<span class="n">FinalizeMaterialResponsePK2</span><span class="p">(</span> <span class="n">parameters</span> <span class="p">)</span>
<span class="n">FinalizeMaterialResponseKirchhoff</span><span class="p">(</span> <span class="n">parameters</span> <span class="p">)</span>
<span class="n">FinalizeMaterialResponseCauchy</span><span class="p">(</span> <span class="n">parameters</span> <span class="p">)</span>
</code></pre></div></div>

<p>An example of usage of the ConstitutiveLaw from within a total lagrangian element could be as follows:</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Parameters</span> <span class="nf">parameters</span><span class="p">(</span><span class="n">GetGeometry</span><span class="p">(),</span> <span class="n">GetProperties</span><span class="p">(),</span> <span class="n">rCurrentProcessInfo</span><span class="p">);</span>

<span class="c1">// Here we essentially set the input parameters</span>
<span class="n">parameters</span><span class="p">.</span><span class="n">SetDeterminantF</span><span class="p">(</span><span class="n">detF</span><span class="p">)</span> <span class="c1">//assuming the determinant is computed somewhere else</span>
<span class="n">parameters</span><span class="p">.</span><span class="n">SetDeformationGradientF</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="c1">//F computed somewhere else</span>

<span class="c1">// Here we set the space on which the results shall be written</span>
<span class="n">Matrix</span> <span class="nf">ConstitutiveTensor</span><span class="p">(</span><span class="n">strain_size</span><span class="p">,</span><span class="n">strain_size</span><span class="p">);</span> <span class="c1">//note that C is allocated in the element</span>
<span class="n">Vector</span> <span class="nf">stress</span><span class="p">(</span><span class="n">strain_size</span><span class="p">);</span>
<span class="n">parameters</span><span class="p">.</span><span class="n">SetConstitutiveMatrix</span><span class="p">(</span><span class="n">ConstitutiveTensor</span><span class="p">)</span> <span class="c1">//assuming the determinant is computed somewhere else</span>
<span class="n">parameters</span><span class="p">.</span><span class="n">SetStressVector</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span> <span class="c1">//F computed somewhere else</span>

<span class="c1">// Instruct the constitutive law that both stress and the constitutivetensor are needed</span>
<span class="n">parameters</span><span class="p">.</span><span class="n">GetOptions</span><span class="p">().</span><span class="n">Set</span><span class="p">(</span><span class="n">COMPUTE_STRESS</span><span class="p">,</span> <span class="n">True</span><span class="p">)</span>
<span class="n">parameters</span><span class="p">.</span><span class="n">GetOptions</span><span class="p">().</span><span class="n">Set</span><span class="p">(</span><span class="n">COMPUTE_CONSTITUTIVE_TENSOR</span><span class="p">,</span> <span class="n">True</span><span class="p">)</span>

<span class="c1">// Actually do the computations in the ConstitutiveLaw    </span>
<span class="n">constitutivelaw</span><span class="o">-&gt;</span><span class="n">CalculateMaterialResponsePK2</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span> <span class="c1">//here the calculations are actually done </span>

<span class="c1">// Here stress and C are already updated since we passed them to the CL</span>
</code></pre></div></div>

<p>The constitutive law also provides helper functions to allow pushing/pulling stresses from one configuration to another.</p>

<h2 id="providing-the-deformation-gradient-f-or-the-strain">Providing the Deformation gradient F or the strain</h2>
<p>Within Kratos the strain can be either provided to the constitutive law as an input parameter, OR obtained internally within the constitutive law
depending on the kinematics chosen.</p>

<h3 id="option-1--provide-strain-as-input-parameter">Option 1 – Provide strain as input parameter</h3>
<p>This option is chosen by selecting</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flags</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="n">USE_ELEMENT_PROVIDED_STRAIN</span><span class="p">,</span> <span class="nb">true</span><span class="p">)</span>
</code></pre></div></div>

<p>in this case the constitutive law reads the value of “StrainVector” and uses it as a basis for the computations of the stresses. Note that this will be implemented only by some of the constitutive laws. The user should hence check if this feature is implemented</p>

<h3 id="option-2--provide-f-as-input-parameter">Option 2 – Provide F as input parameter</h3>
<p>The idea in this case is to provide a DeformationGradient ‘'’F’’’ as an input parameter.</p>

<p>In the case of small deformation kinematics, is is not customary to define the deformation gradient. For this case (small deformations) one one can construct the deformation gradient given the strain vector as</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">F</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">strain</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>     <span class="n">F</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strain</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="n">F</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strain</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strain</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>   <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">strain</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>   <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strain</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strain</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>   <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strain</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">strain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<p>for the 3D case.
The interest of this, is to allow using a large deformation law within a small deformation element.</p>

<h2 id="compatibility-check-features">Compatibility Check Features</h2>
<p>The Constitutive Law provides extensive facilities to check for compatibility between the element and the CL.</p>

<p>The element can ask to the CL for available features (one of the local flags of the CL). for example</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//getting the struct containing the features</span>
<span class="n">ConstitutiveLaw</span><span class="o">::</span><span class="n">Features</span> <span class="n">LawFeatures</span> <span class="o">=</span> <span class="n">cl</span><span class="o">-&gt;</span><span class="n">GetLawFeatures</span><span class="p">(</span><span class="n">LawFeatures</span><span class="p">);</span>

<span class="c1">//check if the law is plane strain (for example)</span>
<span class="n">LawFeatures</span><span class="p">.</span><span class="n">mOptions</span><span class="p">.</span><span class="n">Is</span><span class="p">(</span><span class="n">ConstitutiveLaw</span><span class="o">::</span><span class="n">PLANE_STRAIN_LAW</span><span class="p">)</span>

<span class="c1">//here we get the strain size and the space in which the CL lives</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">expected_strain_size</span> <span class="o">=</span> <span class="n">LawFeatures</span><span class="p">.</span><span class="n">GetStrainSize</span><span class="p">();</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">working_space_dimension</span> <span class="o">=</span> <span class="n">LawFeatures</span><span class="p">.</span><span class="n">GetSpaceDimension</span><span class="p">();</span>
</code></pre></div></div>

<p>this relies on the CL being called implementing the function “GetLawFeatures”, to make an example</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">MyLaw</span><span class="o">::</span><span class="n">GetLawFeatures</span><span class="p">(</span><span class="n">Features</span><span class="o">&amp;</span> <span class="n">rFeatures</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Set the type of law</span>
    <span class="n">rFeatures</span><span class="p">.</span><span class="n">mOptions</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span> <span class="n">PLANE_STRAIN_LAW</span> <span class="p">);</span>
    <span class="n">rFeatures</span><span class="p">.</span><span class="n">mOptions</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span> <span class="n">FINITE_STRAINS</span> <span class="p">);</span>
    <span class="n">rFeatures</span><span class="p">.</span><span class="n">mOptions</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span> <span class="n">ISOTROPIC</span> <span class="p">);</span>

    <span class="c1">// Set strain measure required by the consitutive law</span>
    <span class="n">rFeatures</span><span class="p">.</span><span class="n">mStrainMeasures</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">StrainMeasure_Deformation_Gradient</span><span class="p">);</span>

    <span class="c1">// Set the strain size</span>
    <span class="n">rFeatures</span><span class="p">.</span><span class="n">mStrainSize</span> <span class="o">=</span> <span class="n">GetStrainSize</span><span class="p">();</span>

    <span class="c1">// Set the spacedimension</span>
    <span class="n">rFeatures</span><span class="p">.</span><span class="n">mSpaceDimension</span> <span class="o">=</span> <span class="n">WorkingSpaceDimension</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>additionally each constitutive law provides a ‘’‘“Check”’’’ method, which verifies if the parameters needed are correctly set and if they are in the correct range (for example it may check that the poisson ratio does not exceed 0.5). An example of this could be</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">HyperElasticPlastic3DLaw</span><span class="o">::</span><span class="n">Check</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">Properties</span><span class="o">&amp;</span> <span class="n">rMaterialProperties</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">GeometryType</span><span class="o">&amp;</span> <span class="n">rElementGeometry</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">ProcessInfo</span><span class="o">&amp;</span> <span class="n">rCurrentProcessInfo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">YOUNG_MODULUS</span><span class="p">.</span><span class="n">Key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rMaterialProperties</span><span class="p">[</span><span class="n">YOUNG_MODULUS</span><span class="p">]</span><span class="o">&lt;=</span> <span class="mf">0.00</span><span class="p">)</span>
        <span class="n">KRATOS_ERROR</span> <span class="o">&lt;&lt;</span> <span class="s">"YOUNG_MODULUS has Key zero or invalid value "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">double</span><span class="o">&amp;</span> <span class="n">nu</span> <span class="o">=</span> <span class="n">rMaterialProperties</span><span class="p">[</span><span class="n">POISSON_RATIO</span><span class="p">];</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">check</span> <span class="o">=</span> <span class="kt">bool</span><span class="p">(</span> <span class="p">(</span><span class="n">nu</span> <span class="o">&gt;</span><span class="mf">0.499</span> <span class="o">&amp;&amp;</span> <span class="n">nu</span><span class="o">&lt;</span><span class="mf">0.501</span> <span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">nu</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.999</span> <span class="o">&amp;&amp;</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.01</span> <span class="p">)</span> <span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">POISSON_RATIO</span><span class="p">.</span><span class="n">Key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">check</span><span class="o">==</span><span class="nb">true</span><span class="p">)</span>
        <span class="n">KRATOS_ERROR</span> <span class="o">&lt;&lt;</span> <span class="s">"POISSON_RATIO has Key zero invalid value "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">DENSITY</span><span class="p">.</span><span class="n">Key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">rMaterialProperties</span><span class="p">[</span><span class="n">DENSITY</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.00</span><span class="p">)</span>
        <span class="n">KRATOS_ERROR</span> <span class="o">&lt;&lt;</span> <span class="s">"DENSITY has Key zero or invalid value "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="conversion-between-different-stress-measures">Conversion between different stress measures</h2>
<p>The CL implements pull_back and push_forward mechanism for both the output stress and for the constitutive tensor.
An exampe of use is the following: let’s consider one had a PK2 stress stored in the value PK2_stress_value, and wants to transform it to Cauchy</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Matrix</span> <span class="n">stress_value</span> <span class="o">=</span> <span class="c1">//... here let's suppose that as input we have PK2 stress</span>
<span class="n">stress_value</span> <span class="o">=</span> <span class="n">cl</span><span class="o">-&gt;</span><span class="n">TransformStresses</span><span class="p">(</span>
    <span class="n">stress_value</span><span class="p">,</span> 
    <span class="n">F</span><span class="p">,</span> 
    <span class="n">detF</span><span class="p">,</span> 
    <span class="n">ConstitutiveLawType</span><span class="o">::</span><span class="n">StressMeasure</span><span class="o">::</span><span class="n">StressMeasure_PK2</span><span class="p">,</span>
    <span class="n">ConstitutiveLawType</span><span class="o">::</span><span class="n">StressMeasure</span><span class="o">::</span><span class="n">StressMeasure_Cauchy</span>
<span class="p">);</span>
</code></pre></div></div>

<p>the function implemented in the base class will do internally the necessary transformations so that on output “stress_value” we will get the corresponding Cauchy stress</p>

<p>The base class CL also implements the operations needed to do a pull back and push forward of the constitutive tensor, through the functions</p>

<ul>
  <li>PullBackConstitutiveMatrix</li>
  <li>
    <p>PushForwardConstitutiveMatrix</p>

    <p>… here it would be good an example of usage …</p>
  </li>
</ul>

<h2 id="input-output-features">Input Output features</h2>
<p>The CL provides a GetValue/SetValue interface which allows setting providing or getting output from the CL.
It should be noted however that in order to keep the CL object as lightweight an automatic databas was not provided, meaning that the user needs to provide its own storage. To make an example let’s consider a damage law which stores the variable “mDamage” as a class variable. It is possible to give access both in reading and in writing to this variable by implementing</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span><span class="o">&amp;</span> <span class="n">GetValue</span><span class="p">(</span><span class="k">const</span> <span class="n">Variable</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">rThisVariable</span><span class="p">,</span> <span class="kt">double</span><span class="o">&amp;</span> <span class="n">rValue</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rThisVariable</span> <span class="o">==</span> <span class="n">DAMAGE</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">rValue</span> <span class="o">=</span> <span class="n">mDamage</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">rValue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">KRATOS_ERROR</span> <span class="o">&lt;&lt;</span> <span class="s">"sorry attempting to do a GetValue for the variable "</span> <span class="o">&lt;&lt;</span> <span class="n">rThisVariable</span> <span class="o">&lt;&lt;</span> <span class="s">" which is not available in the CL"</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></div></div>

<p>or</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">SetValue</span><span class="p">(</span><span class="k">const</span> <span class="n">Variable</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">rVariable</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">double</span><span class="o">&amp;</span> <span class="n">rValue</span><span class="p">,</span>
            <span class="k">const</span> <span class="n">ProcessInfo</span><span class="o">&amp;</span> <span class="n">rCurrentProcessInfo</span><span class="p">);</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rThisVariable</span> <span class="o">==</span> <span class="n">DAMAGE</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">mDamage</span> <span class="o">=</span> <span class="n">rValue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">KRATOS_ERROR</span> <span class="o">&lt;&lt;</span> <span class="s">"sorry attempting to do a SetValue for the variable "</span> <span class="o">&lt;&lt;</span> <span class="n">rThisVariable</span> <span class="o">&lt;&lt;</span> <span class="s">" which is not available in the CL"</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></div></div>

<p>the CL also provides a function “CalculateValue” to allow accessing to variables that need to be calculated on the flight. For example to calculate and get the  STRAIN_ENERGY one may do</p>

<div data-lang="C++" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ... here set the options ... </span>
<span class="kt">double</span> <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">CalculateValue</span><span class="p">(</span><span class="n">rParameterValues</span><span class="p">,</span> <span class="n">STRAIN_ENERGY</span><span class="p">,</span> <span class="n">energy</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="storing-state-variables-at-convgerence">Storing State Variables at convgerence</h2>
<p>By design, and with the goal of not storing unnecessary variables, the CLs <strong>should not</strong> store intermediate values of the state variables.
The moment at which InternalVariables should be update is the call to “FinalizeMaterialResponseXXX” which needs to be guaranteed to happen <strong>stricly once</strong> per time step, after convergence is reached. The function FinalizeMaterialResponse can use internally the private flag FINALIZE_MATERIAL_RESPONSE</p>

<h2 id="using-cls-in-an-explicit-context">Using CLs in an explicit context</h2>
<p>The options passed to the “CalculateMaterialResponse” allow the user to avoid the calculation of the ElasticityTensor. It is crucial for performance that in the implementation such flag is respected and that the calculation of the stresses does not imply computing the elasticity tensor</p>

<h2 id="treatment-of-initial-strains">Treatment of Initial Strains</h2>
<p>TBD</p>

<h2 id="interpolate-state-variables">Interpolate State variables</h2>
<p><strong>WARNING!: this is only a proposal and it is NOT currently respected</strong>
The Kratos variable INTERNAL_VARIABLES (of type Vector<Variable>) **has a special meaning**. 
It is designed to contain consecutively all of the converged internal variables.
The function "Calculate" should compute this variable as needed. the function SetValue should allow setting such variables. 
Note that the load and serialize function would benefit making use of this function.</Variable></p>


    <!-- <div class="tags">
        
        <b>Tags: </b>
        
        
        
        
        
    </div> -->

</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2022 CIMNE. All rights reserved. <br />
 Site last generated: Dec 30, 2022 <br />
<p style="padding-right:32px;"><br><img src="/images/company_logo.png" alt="Company logo" height="100px"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
