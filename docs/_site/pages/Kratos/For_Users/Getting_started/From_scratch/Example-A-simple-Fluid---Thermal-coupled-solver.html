<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="Example-A-simple-Fluid---Thermal-coupled-solver.md,  ">

<title>Example A simple Fluid   Thermal coupled solver | Kratos Multiphysics Documentation</title>

<link rel="stylesheet" href="/css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/modern-business.css">

<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/customstyles.css">
<link rel="stylesheet" href="/css/boxshadowproperties.css">

<!-- Most color styles are extracted out to here -->
<link rel="stylesheet" href="/css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<!-- MathJax.js -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script src="/js/toc.js"></script>
<script src="/js/customscripts.js"></script>

<link rel="shortcut icon" href="/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/">&nbsp;<span class="projectTitle"> Kratos Multiphysics Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/KratosMultiphysics/Kratos" target="_blank" rel="noopener">GitHub</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Kratos<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Kratos/For_Users/General/Overview.html">For Users</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/For_Developers/General/Application-Cases.html">For Developers</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Processes/General/Overview.html">Processes</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Utilities/General/Overview.html">Utilities</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Debugging/General/Checking-memory-usage-with-Valgrind.html">Debugging</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Documentation_Guide/General/Overview.html">Documentation Guide</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Workshops/2019/running_an_example_from_GiD.html">Workshops</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Applications<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Applications/Discrete_Element_Modelling_Application/General/Basic-DEM-Benchmarking.html">Discrete Element Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid-Structure_Interaction_Application/General/2D-Mok-benchmark.html">Fluid-Structure Interaction Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid_Dynamics_Application/General/2D-Cavity-flow-problem.html">Fluid Dynamics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Mapping_Application/General/How-to-do-Mapping-between-nonmatching-meshes.html">Mapping Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Meshing_Application/General/Utilities-MMG-Process.html">Meshing Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Particle_Mechanics_Application/General/Overview.html">Particle Mechanics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Reduced_Order_Modelling_Application/General/API-for-RomApplication-(draft-to-be-moved-elsewhere).html">Reduced Order Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Statistics_Application/General/Overview.html">Statistics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Structural_Mechanics_Application/General/0_Roll-up-beam-cantilever.html">Structural Mechanics Application</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:kratosmultiphysics@gmail.com?subject=Kratos Multiphysics Documentation feedback&body=I have some feedback about the Example A simple Fluid   Thermal coupled solver page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: '/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Example A simple Fluid   Thermal coupled solver">{title}</a></li>',
                    noResultsText: '',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">For Users </li>
  
  
  
  <li>
      <a title="General" href="#">General</a>
      <ul>
          
          
          
          <li><a title="Summary" href="/pages/Kratos/For_Users/General/../../../index.html">Summary</a></li>
          
          
          
          
          
          
          <li><a title="Overview" href="/pages/Kratos/For_Users/General/Overview.html">Overview</a></li>
          
          
          
          
          
          
          <li><a title="Management Structure" href="/pages/Kratos/For_Users/General/Management_Structure.html">Management Structure</a></li>
          
          
          
          
          
          
          <li><a title="General Structure" href="/pages/Kratos/For_Users/General/General_Structure.html">General Structure</a></li>
          
          
          
          
          
          
          <li><a title="Copyright and Licence" href="/pages/Kratos/For_Users/General/Copyright_and_Licence.html">Copyright and Licence</a></li>
          
          
          
          
      </ul>
  </li>
  
  
  
  <li>
      <a title="How to get Kratos" href="#">How to get Kratos</a>
      <ul>
          
          
          
          <li><a title="" href=""></a></li>
          
          
          
          <li class="subfolders">
              <a title="Binaries" href="#">Binaries</a>
              <ul>
                  
                  
                  
                  <li><a title="Getting Kratos binaries (via GiD)" href="/pages/Kratos/For_Users/How_to_get_Kratos/Binaries/Getting-Kratos-binaries-with-gid.html">Getting Kratos binaries (via GiD)</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Getting Kratos Binaries for Windows" href="/pages/Kratos/For_Users/How_to_get_Kratos/Binaries/Getting-Kratos-Binaries-for-Windows.html">Getting Kratos Binaries for Windows</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Getting Kratos Binaries for Linux" href="/pages/Kratos/For_Users/How_to_get_Kratos/Binaries/Getting-Kratos-Binaries-for-Linux.html">Getting Kratos Binaries for Linux</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          <li class="subfolders">
              <a title="Compilation" href="#">Compilation</a>
              <ul>
                  
                  
                  
                  <li><a title="Compilation Options" href="/pages/Kratos/For_Users/How_to_get_Kratos/Compilation/remote_Compilation_Options.html">Compilation Options</a></li>
                  
                  
                  
                  
                  
                  <li><a title="How to Compile Kratos in Debug mode" href="/pages/Kratos/For_Users/How_to_get_Kratos/Compilation/How-to-Compile-Kratos-in-Debug-mode.html">How to Compile Kratos in Debug mode</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Linux Build" href="/pages/Kratos/For_Users/How_to_get_Kratos/Compilation/Linux-Build.html">Linux Build</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          
      </ul>
  </li>
  
  
  
  <li>
      <a title="Getting started" href="#">Getting started</a>
      <ul>
          
          
          
          <li><a title="Kernel and Applications" href="/pages/Kratos/For_Users/Getting_started/Editing-kratos-kernel-and-application-approach.html">Kernel and Applications</a></li>
          
          
          
          
          
          
          <li><a title="Python Script  Getting Started" href="/pages/Kratos/For_Users/Getting_started/getting-started.html">Python Script  Getting Started</a></li>
          
          
          
          
          
          
          <li><a title="Python Script  Hello Kratos" href="/pages/Kratos/For_Users/Getting_started/hello-world.html">Python Script  Hello Kratos</a></li>
          
          
          
          
          
          
          <li><a title="Python Tutorials" href="/pages/Kratos/For_Users/Getting_started/tutorials.html">Python Tutorials</a></li>
          
          
          
          <li class="subfolders">
              <a title="Data Structure" href="#">Data Structure</a>
              <ul>
                  
                  
                  
                  <li><a title="Entities creation from scratch" href="/pages/Kratos/For_Users/Getting_started/Data_Structure/Entities-creation-from-scratch.html">Entities creation from scratch</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Python Script  Generating New Modelparts" href="/pages/Kratos/For_Users/Getting_started/Data_Structure/generate-new-modelpart.html">Python Script  Generating New Modelparts</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Python Script  ModelPart Elements and Conditions" href="/pages/Kratos/For_Users/Getting_started/Data_Structure/elems-and-conds.html">Python Script  ModelPart Elements and Conditions</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Python Script  ModelPart and SubModelPart" href="/pages/Kratos/For_Users/Getting_started/Data_Structure/modelpart-and-submodelpart.html">Python Script  ModelPart and SubModelPart</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Python Script  Nodes and Nodal Data" href="/pages/Kratos/For_Users/Getting_started/Data_Structure/nodes-and-data.html">Python Script  Nodes and Nodal Data</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          <li class="subfolders">
              <a title="From scratch" href="#">From scratch</a>
              <ul>
                  
                  
                  
                  <li><a title="Creating a base application" href="/pages/Kratos/For_Users/Getting_started/From_scratch/Creating-a-base-application.html">Creating a base application</a></li>
                  
                  
                  
                  
                  
                  <li class="active"><a title="Example A simple Fluid   Thermal coupled solver" href="/pages/Kratos/For_Users/Getting_started/From_scratch/Example-A-simple-Fluid---Thermal-coupled-solver.html">Example A simple Fluid   Thermal coupled solver</a></li>
                  
                  
                  
                  
                  
                  <li><a title="How to Create a New Application using cmake" href="/pages/Kratos/For_Users/Getting_started/From_scratch/How-to-Create-a-New-Application-using-cmake.html">How to Create a New Application using cmake</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Implementing thermal solver" href="/pages/Kratos/For_Users/Getting_started/From_scratch/Implementing-thermal-solver.html">Implementing thermal solver</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Kratos For Dummies Stationary heat transfer" href="/pages/Kratos/For_Users/Getting_started/From_scratch/Kratos-For-Dummies-Stationary-heat-transfer.html">Kratos For Dummies Stationary heat transfer</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Kratos For Dummies Transient non linear heat transfer" href="/pages/Kratos/For_Users/Getting_started/From_scratch/Kratos-For-Dummies-Transient-non-linear-heat-transfer.html">Kratos For Dummies Transient non linear heat transfer</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          <li class="subfolders">
              <a title="Input Output and Visualization" href="#">Input Output and Visualization</a>
              <ul>
                  
                  
                  
                  <li><a title="How to interact with a simulation to visualize real time results" href="/pages/Kratos/For_Users/Getting_started/Input_Output_and_Visualization/How-to-interact-with-a-simulation-to-visualize-real-time-results.html">How to interact with a simulation to visualize real time results</a></li>
                  
                  
                  
                  
                  
                  <li><a title="How to write a JSON configuration file" href="/pages/Kratos/For_Users/Getting_started/Input_Output_and_Visualization/How-to-write-a-JSON-configuration-file.html">How to write a JSON configuration file</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Input data" href="/pages/Kratos/For_Users/Getting_started/Input_Output_and_Visualization/Input-data.html">Input data</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Python Script  Reading ModelPart From Input File" href="/pages/Kratos/For_Users/Getting_started/Input_Output_and_Visualization/reading-input.html">Python Script  Reading ModelPart From Input File</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Python Script  Reading ProjectParameters" href="/pages/Kratos/For_Users/Getting_started/Input_Output_and_Visualization/project-parameters.html">Python Script  Reading ProjectParameters</a></li>
                  
                  
                  
                  
                  
                  <li><a title="Python Script  Writing Output File" href="/pages/Kratos/For_Users/Getting_started/Input_Output_and_Visualization/writing-output.html">Python Script  Writing Output File</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          
      </ul>
  </li>
  
  
  
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Example A simple Fluid   Thermal coupled solver</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" rel="noopener" href="https://github.com/KratosMultiphysics/Kratos/tree/master/docs/pages/Kratos/For_Users/Getting_started/From_scratch/Example-A-simple-Fluid---Thermal-coupled-solver.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

   <p>Let’s consider we wish to solve a simple fluid-thermal problem in which the velocity field obtained by a <strong>CFD</strong> analysis is to be employed as a basis in the related <em>thermal convection-diffusion</em> problem. You can download the example <a href="https://github.com/KratosMultiphysics/Documentation/raw/master/Wiki_files/Example:-A-simple-Fluid-Thermal-solver/coupled_thermal_cylinder.gid.zip">here</a>.</p>

<p>Conceptually, the problem is a very simple one-way coupled problem, in which the temperature <em>convection-diffusion</em> problem is governed by the fluid flow. Provided that the same mesh is employed in the same domain, we would expect the solution to be equivalent to doing:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="n">fluid_solver</span><span class="p">.</span><span class="n">Solve</span><span class="p">()</span> <span class="c1">#here we compute VELOCITY
</span>     <span class="n">thermal_solver</span><span class="p">.</span><span class="n">Solve</span><span class="p">()</span> <span class="c1">#here we use VELOCITY to convect the temperature.
</span></code></pre></div></div>

<p>Current tutorial is about implementing such behaviour within the Kratos framework.</p>

<h1 id="implementation">Implementation</h1>

<p>In the previous part of the tutorial we discussed the existance of two objecs: a <strong>Stage</strong> and a <strong>Solver</strong> .
The implementation of the proposed coupled problem involves dealing with the physics of the problem. The time stepping involved as well as the application of the Boundary Conditions is equivalent to that of a “normal” <strong>CFD</strong> problem, we will thus use the standard <strong>Stage</strong> employed in the <strong>CFD</strong> solution and implement a new <code class="language-plaintext highlighter-rouge">CoupledThermalSolver</code></p>

<p>An example of implementation of such a solver can be found <a href="https://github.com/KratosMultiphysics/Kratos/blob/Release-6.0/applications/FluidDynamicsApplication/python_scripts/coupled_fluid_thermal_solver.py">here</a></p>

<p>however let’s go step by step and consider the design of such a solver.</p>

<p>The first step is to load in the memory the libraries needed. This is achieved by doing</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="c1"># Importing the Kratos Library
</span>     <span class="kn">import</span> <span class="nn">KratosMultiphysics</span>
     
     <span class="c1"># Check that applications were imported in the main script
</span>     <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">CheckRegisteredApplications</span><span class="p">(</span><span class="s">"FluidDynamicsApplication"</span><span class="p">)</span>
     <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">CheckRegisteredApplications</span><span class="p">(</span><span class="s">"ConvectionDiffusionApplication"</span><span class="p">)</span>
     
     <span class="c1"># Import applications
</span>     <span class="kn">import</span> <span class="nn">KratosMultiphysics.FluidDynamicsApplication</span> <span class="k">as</span> <span class="n">KratosCFD</span>
     <span class="kn">import</span> <span class="nn">KratosMultiphysics.ConvectionDiffusionApplication</span> <span class="k">as</span> <span class="n">ConvDiff</span>
</code></pre></div></div>

<p>note that the libraries should be imported first in the main script, we verify this by calling the <code class="language-plaintext highlighter-rouge">CheckRegisteredApplications</code> to verify that the library is already loaded before entering in the current script.</p>

<h2 id="solver-construction">Solver Construction</h2>
<p>The next step is to define a class implementing the behaviour we need. We do so by defining the class we want, as well as a <code class="language-plaintext highlighter-rouge">CreateSolver </code> auxiliary function to be used in the object construction</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">CreateSolver</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">,</span> <span class="n">custom_settings</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CoupledFluidThermalSolver</span><span class="p">(</span><span class="n">main_model_part</span><span class="p">,</span> <span class="n">custom_settings</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">CoupledFluidThermalSolver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</code></pre></div></div>

<p>We now need to decide which solving technology shall be employed in solving the <strong>CFD</strong> and <strong>Thermal</strong> problems. 
Many possibilities exist to this end, since in principle any combination of transient solvers is viable.</p>

<p>The best way to go is thus to postpone the decision on the choice of the solvers to runtime, so that the user is allowed to pick the choice out of the existing possibilities.
The concept here is simple: from the point of view of the coupling the two solvers are a black-box. We shall configure them as we would if we were to solve an uncoupled problem, by simply nesting the corresponding configuration file in the config being passed to the coupled solver. This is done in the class constructor by doing</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">custom_settings</span><span class="p">):</span>
            
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span> 
           
        <span class="n">default_settings</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">Parameters</span><span class="p">(</span><span class="s">"""
        {
             "model_part_name" : "MainModelPart",
             "solver_type" : "ThermallyCoupled",
             "fluid_solver_settings": {
                 "solver_type": "navier_stokes_solver_vmsmonolithic",
                 "model_import_settings": {
                     "input_type": "mdpa",
                     "input_filename": "unknown_name"
                 }
             },
             "thermal_solver_settings": {
                 "solver_type": "Transient",
                 "analysis_type": "linear",
                 "model_import_settings": {
                     "input_type": "use_input_model_part",
                     "input_filename": "unknown_name"
                 },
                 "computing_model_part_name": "Thermal",
                 "material_import_settings": {
                     "materials_filename": "ThermicMaterials.json"
                 },
                 "convection_diffusion_variables": {
                     "density_variable": "DENSITY",
                     "diffusion_variable": "CONDUCTIVITY",
                     "unknown_variable": "TEMPERATURE",
                     "volume_source_variable": "HEAT_FLUX",
                     "surface_source_variable": "FACE_HEAT_FLUX",
                     "projection_variable": "PROJECTED_SCALAR1",
                     "convection_variable": "CONVECTION_VELOCITY",
                     "mesh_velocity_variable": "MESH_VELOCITY",
                     "transfer_coefficient_variable": "",
                     "velocity_variable": "VELOCITY",
                     "specific_heat_variable": "SPECIFIC_HEAT",
                     "reaction_variable": "REACTION_FLUX"
                 }
             }
         }"""</span><span class="p">)</span>

         <span class="c1">## Overwrite the default settings with user-provided parameters
</span>         <span class="bp">self</span><span class="p">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">custom_settings</span>
         <span class="bp">self</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">ValidateAndAssignDefaults</span><span class="p">(</span><span class="n">default_settings</span><span class="p">)</span>

         <span class="n">model_part_name</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="s">"model_part_name"</span><span class="p">].</span><span class="n">GetString</span><span class="p">()</span>
         <span class="bp">self</span><span class="p">.</span><span class="n">main_model_part</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">[</span><span class="n">model_part_name</span><span class="p">]</span>
         <span class="kn">import</span> <span class="nn">python_solvers_wrapper_fluid</span>
         <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span> <span class="o">=</span> <span class="n">python_solvers_wrapper_fluid</span><span class="p">.</span><span class="n">CreateSolverByParameters</span><span class="p">(</span>
             <span class="bp">self</span><span class="p">.</span><span class="n">main_model_part</span><span class="p">,</span> 
             <span class="bp">self</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="s">"fluid_solver_settings"</span><span class="p">],</span><span class="s">"OpenMP"</span><span class="p">)</span>
            
        
         <span class="bp">self</span><span class="p">.</span><span class="n">thermal_model_part</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">CreateModelPart</span><span class="p">(</span><span class="s">"thermal_model_part"</span><span class="p">)</span>
         <span class="n">modeler</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">ConnectivityPreserveModeler</span><span class="p">()</span>
         <span class="n">modeler</span><span class="p">.</span><span class="n">GenerateModelPart</span><span class="p">(</span>
             <span class="bp">self</span><span class="p">.</span><span class="n">main_model_part</span><span class="p">,</span> 
             <span class="bp">self</span><span class="p">.</span><span class="n">thermal_model_part</span><span class="p">,</span> 
             <span class="s">"Element2D3N"</span><span class="p">,</span> 
             <span class="s">"Condition2D2N"</span><span class="p">)</span>
         
         <span class="kn">import</span> <span class="nn">python_solvers_wrapper_convection_diffusion</span>
         <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span> <span class="o">=</span> <span class="n">python_solvers_wrapper_convection_diffusion</span><span class="p">.</span><span class="n">CreateSolverByParameters</span><span class="p">(</span>
             <span class="bp">self</span><span class="p">.</span><span class="n">thermal_model_part</span><span class="p">,</span>
             <span class="bp">self</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="s">"thermal_solver_settings"</span><span class="p">],</span>
             <span class="s">"OpenMP"</span><span class="p">)</span>
</code></pre></div></div>
<p>If we take a detailed look, we observe that we added a variable <code class="language-plaintext highlighter-rouge">default_settings</code>, which tells which will be the default configuration involved in the solution phase. In this specific case, the default settings has a structure of the type</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">default_settings</span> <span class="o">=</span> <span class="p">{</span>
       <span class="s">"solver_type"</span> <span class="p">:</span> <span class="p">...</span><span class="n">here</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">solver</span> <span class="p">...,</span>
       <span class="s">"fluid_solver_settings"</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span> <span class="n">CFD</span> <span class="n">solver</span> <span class="n">settings</span> <span class="p">...</span> <span class="p">},</span>
       <span class="s">"thermal_solver_settings"</span><span class="p">:</span> <span class="p">{...</span> <span class="n">thermal</span> <span class="n">solver</span> <span class="n">settings</span> <span class="p">...</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Such default settings are overridden by the user-provided options, passed in the constructor as <code class="language-plaintext highlighter-rouge">settings</code>.
The user-provided settings may however contain wrong or unexpected input, or simply miss some information (for example not making a choice for the thermal solver).
We thus want to “validate” them against the defaults, which is achieved by the call:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="bp">self</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">ValidateAndAssignDefaults</span><span class="p">(</span><span class="n">default_settings</span><span class="p">)</span>
</code></pre></div></div>

<p>In this specific case this function verifies that the inputs are <code class="language-plaintext highlighter-rouge">solver_type</code>,<code class="language-plaintext highlighter-rouge">fluid_solver_settings</code>,<code class="language-plaintext highlighter-rouge">thermal_solver_settings</code> and that they are respectively a string and two “nested parameters objects”. The user-provided settings cannot provide any other entry. This allows to throw an error if a misspelled entry is provided as input.
In the case the input does not contain one of the given entries (for example the thermal_solver_settings) such entry is taken from the defaults.
An important feature of the  <code class="language-plaintext highlighter-rouge">ValidateAndAssignDefaults</code> is that it acts only on the outmost level. It does <strong>NOT</strong> do any validation on the subparameters.</p>

<p>The idea is that we can now construct the <code class="language-plaintext highlighter-rouge">fluid_solver</code> and the <code class="language-plaintext highlighter-rouge">thermal_solver</code> by passing the parameters. 
This is done by the lines</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">import</span> <span class="nn">python_solvers_wrapper_fluid</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span> <span class="o">=</span> <span class="n">python_solvers_wrapper_fluid</span><span class="p">.</span><span class="n">CreateSolverByParameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">main_model_part</span><span class="p">,</span> 
        <span class="bp">self</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="s">"fluid_solver_settings"</span><span class="p">],</span>
        <span class="s">"OpenMP"</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">python_solvers_wrapper_convection_diffusion</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span> <span class="o">=</span> <span class="n">python_solvers_wrapper_convection_diffusion</span><span class="p">.</span><span class="n">CreateSolverByParameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_model_part</span><span class="p">,</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">settings</span><span class="p">[</span><span class="s">"thermal_solver_settings"</span><span class="p">],</span>
        <span class="s">"OpenMP"</span><span class="p">)</span>
</code></pre></div></div>

<p>:warning: The syntax of these functions will probably change in the next future for something equivalent.</p>

<p>note that here we pass to the factory functions the subparameters as taken from the self.settings .
Validation of the relevant settings is thus demanded to each of the solvers, which will use hierarchically a mechanism similar to the one described here.</p>

<p>Aside of the details in any case the new solver now defined two inner solvers called</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span>
</code></pre></div></div>

<p>which are now ready for use. The rest of the class implementation now consists in simply calling the relevant functions for the new solver.</p>

<h2 id="addvariables-adddofs-importmodelpart">AddVariables, AddDofs, ImportModelPart</h2>
<p>The new solver implements the solver API, and thus defines a number of functions. Let’s take a look at them:</p>

<p>The AddVariables function allocated memory for the variables needed. Essentially any solver tells to the corresponding modelpart which variables need to be stored in the database. For example, the <strong>CFD</strong> solver will require <code class="language-plaintext highlighter-rouge">VELOCITY </code>while the thermal solver will require <code class="language-plaintext highlighter-rouge">TEMPERATURE</code>.
:warning:  A hack is needed as of now, however this will be cleaned up in the next future</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">AddVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">AddVariables</span><span class="p">()</span>
        
        <span class="c1">#this is a HACK: TODO: cleanup so that this is not needed in the future 
</span>        <span class="c1">#the problem is that variables are not added to the fluid_solver.MainModelPart 
</span>        <span class="c1">#who is in charge of creating the nodes
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">main_model_part</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">main_model_part</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">main_model_part</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">AddVariables</span><span class="p">()</span>

        <span class="c1">#this is a HACK: TODO: cleanup so that this is not needed in the future 
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">main_model_part</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">tmp</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">ImportModelPart </code>function is in charge of importing the modelparts involved.<br />
by taking a look on the default settings, we can observe that the fluid settings contain</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="s">"fluid_solver_settings"</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">...</span>
        <span class="s">"model_import_settings"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"input_type"</span><span class="p">:</span> <span class="s">"mdpa"</span><span class="p">,</span>
            <span class="s">"input_filename"</span><span class="p">:</span> <span class="s">"unknown_name"</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>while the thermal settings are slightly different:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="s">"thermal_solver_settings"</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">...</span>
        <span class="s">"model_import_settings"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"input_type"</span><span class="p">:</span> <span class="s">"use_input_model_part"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="p">...</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>this expresses that the <code class="language-plaintext highlighter-rouge">fluid_model_part</code> will be read from a file (named <code class="language-plaintext highlighter-rouge">input_filename</code>), while the <code class="language-plaintext highlighter-rouge">thermal_solver</code> expects the termal_solver to be already available. This is so as instead of reading the <code class="language-plaintext highlighter-rouge">thermal_model_part</code> from a file, we construct it on the basis of the <code class="language-plaintext highlighter-rouge">fluid_solver</code>, <strong>so that it shares the same nodes</strong>.
This is achieved by the class</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="n">modeler</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">ConnectivityPreserveModeler</span><span class="p">()</span>
</code></pre></div></div>

<p>which fills the thermal modelpart with new elements and conditions, preserving however the same nodes (Pointers) as for the source modelpart (the fluid) as well as the same connectivity.</p>

<p>The overall importing function thus looks</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">ImportModelPart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">ImportModelPart</span><span class="p">()</span>
        
        <span class="c1">#here cloning the fluid modelpart to thermal_model_part so that the nodes are shared
</span>        <span class="n">modeler</span> <span class="o">=</span> <span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">ConnectivityPreserveModeler</span><span class="p">()</span>
        <span class="n">modeler</span><span class="p">.</span><span class="n">GenerateModelPart</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">main_model_part</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">thermal_model_part</span><span class="p">,</span>
            <span class="s">"Element2D3N"</span><span class="p">,</span>
             <span class="s">"Condition2D2N"</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">ImportModelPart</span><span class="p">()</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">AddDofs</code> function simply adds the Dofs needed in the solution problem and presents no difficulty</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">AddDofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">AddDofs</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">AddDofs</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="solution-process">Solution Process</h2>
<p>Even though conceptually the solution process consists in calling consecutively the two solvers, the solve function is split in several steps within kratos.</p>

<p>The Initialize function in particular is designed to be called exactly once, same as the <code class="language-plaintext highlighter-rouge">Check()</code> function.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">Initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">Initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">Initialize</span><span class="p">()</span>
</code></pre></div></div>

<p>Each complete solution step is organized as</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="bp">self</span><span class="p">.</span><span class="n">InitializeSolutionStep</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">Predict</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">SolveSolutionStep</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">FinalizeSolutionStep</span><span class="p">()</span>
</code></pre></div></div>

<p>where each of the substeps take into account the different solvers as in:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">InitializeSolutionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">InitializeSolutionStep</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">InitializeSolutionStep</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">Predict</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">Predict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">SolveSolutionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">SolveSolutionStep</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">SolveSolutionStep</span><span class="p">()</span>
        

    <span class="k">def</span> <span class="nf">FinalizeSolutionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">FinalizeSolutionStep</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">FinalizeSolutionStep</span><span class="p">()</span>
</code></pre></div></div>

<p>Where the functions:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">InitializeSolutionStep</code></li>
  <li><code class="language-plaintext highlighter-rouge">FinalizeSolutionStep</code>
are to be called <strong>EXACTLY ONCE</strong> per time step.</li>
</ul>

<p>Indeed for a simple one-way coupled problem as the one at hand, this is exactly equivalent to calling the <code class="language-plaintext highlighter-rouge">Solve</code> function for both solvers. The <code class="language-plaintext highlighter-rouge">Solve</code> functions are however split into several substeps as for  complex solvers two way coupled solvers one would do something equivalent to</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">Solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#do once per time step
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">InitializeSolutionStep</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">Predict</span><span class="p">()</span>

        <span class="c1">#non linear loop
</span>        <span class="n">converged</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="n">converged</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">SolveSolutionStep</span><span class="p">()</span>
            <span class="p">...</span><span class="n">maybe</span> <span class="n">here</span> <span class="n">change</span> <span class="n">something</span> <span class="n">to</span> <span class="n">make</span> <span class="n">the</span> <span class="n">problem</span> <span class="n">two</span> <span class="n">way</span> <span class="n">coupled</span> <span class="p">...</span>
            <span class="n">converged</span> <span class="o">=</span> <span class="p">...</span><span class="n">here</span> <span class="n">a</span> <span class="n">convergence_check</span>

        <span class="c1">#do once per time step
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">FinalizeSolutionStep</span><span class="p">()</span>
</code></pre></div></div>

<p>this subdivision is essential since by guaranteeing that <code class="language-plaintext highlighter-rouge">FinalizeSolutionStep</code> is called just once, we provide a safe place for updating internal variables.</p>

<p>#Advancing in time
The time stepping is dealt into the <strong>Stage</strong>. The time advancement from one step to the next is however done in the <strong>Solver</strong>. The releavant functions are:</p>

<p>The funciton <code class="language-plaintext highlighter-rouge">GetMinimumBufferSize</code> telling how many steps in the past need to be preserved</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">GetMinimumBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">buffer_size_fluid</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">fluid_solver</span><span class="p">.</span><span class="n">GetMinimumBufferSize</span><span class="p">()</span>
        <span class="n">buffer_size_thermal</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">thermal_solver</span><span class="p">.</span><span class="n">GetMinimumBufferSize</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">buffer_size_fluid</span><span class="p">,</span> <span class="n">buffer_size_thermal</span><span class="p">)</span>
</code></pre></div></div>

<p>and <code class="language-plaintext highlighter-rouge">AdvanceInTime</code> which actually makes the time to progress.
it is important to make a remark here: <strong>since the nodes are shared between the modelparts the <code class="language-plaintext highlighter-rouge">CloneTimeStep</code> function should be done only on one of the modelparts</strong></p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">AdvanceInTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">ComputeDeltaTime</span><span class="p">()</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="c1">#NOTE: the cloning is done ONLY ONCE since the nodes are shared
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">main_model_part</span><span class="p">.</span><span class="n">CloneTimeStep</span><span class="p">(</span><span class="n">new_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">main_model_part</span><span class="p">.</span><span class="n">ProcessInfo</span><span class="p">[</span><span class="n">KratosMultiphysics</span><span class="p">.</span><span class="n">STEP</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">new_time</span>
</code></pre></div></div>


    <!-- <div class="tags">
        
        <b>Tags: </b>
        
        
        
        
        
    </div> -->

</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2022 CIMNE. All rights reserved. <br />
 Site last generated: Dec 30, 2022 <br />
<p style="padding-right:32px;"><br><img src="/images/company_logo.png" alt="Company logo" height="100px"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
