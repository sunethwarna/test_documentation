<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="multiphysics_example.md,  ">

<title>Multiphysics Example | Kratos Multiphysics Documentation</title>

<link rel="stylesheet" href="/css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/modern-business.css">

<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/customstyles.css">
<link rel="stylesheet" href="/css/boxshadowproperties.css">

<!-- Most color styles are extracted out to here -->
<link rel="stylesheet" href="/css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<!-- MathJax.js -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script src="/js/toc.js"></script>
<script src="/js/customscripts.js"></script>

<link rel="shortcut icon" href="/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/">&nbsp;<span class="projectTitle"> Kratos Multiphysics Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/KratosMultiphysics/Kratos" target="_blank" rel="noopener">GitHub</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Kratos<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Kratos/For_Users/General/Overview.html">For Users</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/For_Developers/General/Application-Cases.html">For Developers</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Processes/General/Overview.html">Processes</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Utilities/General/Overview.html">Utilities</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Debugging/General/Checking-memory-usage-with-Valgrind.html">Debugging</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Documentation_Guide/General/Overview.html">Documentation Guide</a></li>
                        
                        
                        
                        <li><a href="/pages/Kratos/Workshops/2019/running_an_example_from_GiD.html">Workshops</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Applications<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/pages/Applications/Discrete_Element_Modelling_Application/General/Basic-DEM-Benchmarking.html">Discrete Element Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid-Structure_Interaction_Application/General/2D-Mok-benchmark.html">Fluid-Structure Interaction Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Fluid_Dynamics_Application/General/2D-Cavity-flow-problem.html">Fluid Dynamics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Mapping_Application/General/How-to-do-Mapping-between-nonmatching-meshes.html">Mapping Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Meshing_Application/General/Utilities-MMG-Process.html">Meshing Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Particle_Mechanics_Application/General/Overview.html">Particle Mechanics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Reduced_Order_Modelling_Application/General/API-for-RomApplication-(draft-to-be-moved-elsewhere).html">Reduced Order Modelling Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Statistics_Application/General/Overview.html">Statistics Application</a></li>
                        
                        
                        
                        <li><a href="/pages/Applications/Structural_Mechanics_Application/General/0_Roll-up-beam-cantilever.html">Structural Mechanics Application</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:kratosmultiphysics@gmail.com?subject=Kratos Multiphysics Documentation feedback&body=I have some feedback about the Multiphysics Example page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: '/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Multiphysics Example">{title}</a></li>',
                    noResultsText: '',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Workshops </li>
  
  
  
  <li>
      <a title="2019" href="#">2019</a>
      <ul>
          
          
          
          <li><a title="Running an example from GiD" href="/pages/Kratos/Workshops/2019/running_an_example_from_GiD.html">Running an example from GiD</a></li>
          
          
          
          
          
          
          <li><a title="Kratos Input Files and IO" href="/pages/Kratos/Workshops/2019/kratos_input_files_and_io.html">Kratos Input Files and IO</a></li>
          
          
          
          
          
          
          <li><a title="Data Management" href="/pages/Kratos/Workshops/2019/data_management.html">Data Management</a></li>
          
          
          
          
          
          
          <li><a title="Solving Strategies" href="/pages/Kratos/Workshops/2019/solving_strategies.html">Solving Strategies</a></li>
          
          
          
          
          
          
          <li><a title="Manipulating Solution Values" href="/pages/Kratos/Workshops/2019/manipulating_solution_values.html">Manipulating Solution Values</a></li>
          
          
          
          
          
          
          <li class="active"><a title="Multiphysics Example" href="/pages/Kratos/Workshops/2019/multiphysics_example.html">Multiphysics Example</a></li>
          
          
          
          
      </ul>
  </li>
  
  
  
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Multiphysics Example</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" rel="noopener" href="https://github.com/KratosMultiphysics/Kratos/tree/master/docs/pages/Kratos/Workshops/2019/multiphysics_example.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

   <h1 id="multiphysics-example"><strong>Multiphysics example</strong></h1>

<h2 id="objective">Objective</h2>
<p>The main goal is to become familiar with key aspects of multiphysics simulations using a prototypical example. The chosen problem is a case of fluid-structure interaction. One should become familiar with the various components involved in setting up and running such simulations, as well as the necessary steps to ensure the quality and physical relevance of results.</p>

<p>The first example will be used in a black-box manner to discuss the most important details related to setting up such cases and the corresponding parameters. The second example depicts how one could create own - so customized - mapping and solvers to further enhance existing capabilities.</p>

<p><strong>Suggestion:</strong> as soon as you are here, you should download the <a href="https://github.com/KratosMultiphysics/Documentation/blob/master/Workshops_files/Kratos_Workshop_2019/Sources/6_multiphysics/6_multiphysics.zip">source files</a> and start running the respective simulations from the command line as explained in <a href="https://github.com/KratosMultiphysics/Kratos/wiki/Kratos-input-files-and-IO">Kratos input files and IO</a> (section 2.2: <em>Run Kratos from the command line</em>) . As there are 2 examples intended to be shown, it would be sufficient if every other person would run one and the remaining participants the other, preferably in groups of two.</p>
<ul>
  <li>Simulation 1: in <code class="language-plaintext highlighter-rouge">6_multiphysics\FSIBlackboxGeneric\MainKratos.py</code></li>
  <li>Simulation 2: in <code class="language-plaintext highlighter-rouge">6_multiphysics\FSICustomizedSDoFVortexShedding\MainKratosFSI.py</code></li>
</ul>

<h2 id="1-fsi-black-box-generic">1. FSI Black-box generic</h2>
<p>The discussion relies on the examples discussed in <a href="https://github.com/KratosMultiphysics/Kratos/wiki/Running-an-example-from-GiD">Running an example from GiD</a>. Here it was shown how a CFD (section 3) and a CSM (section 4) can be set up and run. Additionally, in section 5 an FSI example was provided which builds upon the CFD and CSM setups.</p>

<p><img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi1.jpg" width="500px" class="center" /></p>

<p>For this you should download and refer to the input files for <a href="https://github.com/KratosMultiphysics/Documentation/blob/master/Workshops_files/Kratos_Workshop_2019/Sources/6_multiphysics/6_multiphysics.zip">the respective case</a>.</p>

<p>The main components of this certain multiphysics case - an FSI simulation - are:</p>
<ul>
  <li>the CFD “simulation”: model part <code class="language-plaintext highlighter-rouge">KratosWorkshop2019_high_rise_building_FSI_Fluid.mdpa</code> and respective settings<code class="language-plaintext highlighter-rouge"> "structure_solver_settings"</code></li>
  <li>the CSM “simulation” : model part <code class="language-plaintext highlighter-rouge">KratosWorkshop2019_high_rise_building_FSI_Structural.mdpa</code> and respective settings <code class="language-plaintext highlighter-rouge">"fluid_solver_settings"</code></li>
</ul>

<p>The settings are now all contained in one file, the <code class="language-plaintext highlighter-rouge">ProjectParameters.json</code>:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="nl">"solver_settings"</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"solver_type"</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="s2">"Partitioned"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"coupling_scheme"</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">"DirichletNeumann"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"echo_level"</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"structure_solver_settings"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="nl">"fluid_solver_settings"</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="nl">"mesh_solver_settings"</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="nl">"coupling_settings"</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>As it can be observed that there are more settings blocks, as additional components are needed to enable the proper functioning.</p>

<ul>
  <li>the <strong>solver type</strong>: when referring to multiphysics simulations, one generally tries to deal with a complex problem, which can be solved in various manners: either <em>monolithic</em> (which leads to one large system to be solved) or <em>partitioned</em> (which implies splitting up the problem into dedicated fields, dealing with these separately and ensuring proper data transfer and convergence</li>
</ul>

<p><img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi2.jpg" width="550px" class="center" /></p>

<ul>
  <li>the <strong>coupling scheme</strong>: here a <em>Dirichlet-Neumann</em>-type coupling is used, which specifies which values are affected by the mapping, more precisely for this case: the CFD simulation results in fluid forces on the respective structure interface, these forces being transferred (mapped) onto the structure and serving as the right hand side (RHS - or force vector), so as a Neumann boundary condition for the CSM; the CSM solve results in the deformation of the structural model, the deformations from the boundary to the fluid are transferred (mapped) onto the CFD domain, these deformations serving affecting the left hand side (LHS - or the vector of primary variables) for the pseudo-structural problem (refer to the next point of the <em>mesh solver</em>), constituting a Dirichlet boundary condition</li>
</ul>

<p><img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi3.jpg" width="650px" class="center" /></p>

<ul>
  <li>the <strong>mesh solver</strong> and its settings: this builds upon the existing parts of the CFD (see the provided <code class="language-plaintext highlighter-rouge">"model_part_name"</code>) and is responsible for deforming the CFD mesh in order to consistently match the deformations on the interface of the fluid to the structure, which is done using a pseudo-structural formulation (hinted by the naming of the <code class="language-plaintext highlighter-rouge">"solver_type"</code>), as the mesh deformations are solved as if this was a structural mechanics problem with prescribed deformations on the respective boundary
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"mesh_solver_settings"</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"echo_level"</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"domain_size"</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
          </span><span class="nl">"model_part_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"FluidModelPart"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"solver_type"</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">"structural_similarity"</span><span class="w">
      </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre></div>    </div>
    <p>Note: the mesh solver will require additional boundary conditions. For this particular case, the nodes on the inlet, top, bottom and outlet will need to have a prescribed value for (mesh) displacement of zero. These can be seen in the respective blocks of the project parameters (in the <code class="language-plaintext highlighter-rouge">"fluid_boundary_conditions_process_list"</code>), such as:</p>
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
          </span><span class="nl">"python_module"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"assign_vector_variable_process"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"kratos_module"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"KratosMultiphysics"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Parameters"</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"model_part_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"FluidModelPart.ALEMeshDisplacementBC2D_FluidALEMeshBC"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"variable_name"</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="s2">"MESH_DISPLACEMENT"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"constrained"</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kc">true</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">true</span><span class="p">],</span><span class="w">
              </span><span class="nl">"value"</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="w">
              </span><span class="nl">"interval"</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="s2">"End"</span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
    <p>where <em>ALE</em> stands for the <em>Arbitrary-Lagrangian-Eulerian</em> formulation.</p>
  </li>
  <li>the <strong>coupling</strong> and its settings: coupling the above solver is done in an partitioned manner using iterations to lead to convergence; it is important to note the <code class="language-plaintext highlighter-rouge">"mapper_settings"</code>, which is responsible for providing the necessary information to setup and carry out the mapping (transfer) of necessary data fields; <code class="language-plaintext highlighter-rouge">"coupling_strategy_settings"</code> defines the way the inner iterations are done to achieve convergence at the interface; additionally the correct sub model parts need to provided - <code class="language-plaintext highlighter-rouge">"structure_interfaces_list"</code> and <code class="language-plaintext highlighter-rouge">"fluid_interfaces_list"</code>
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="nl">"coupling_settings"</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"nl_tol"</span><span class="w">                       </span><span class="p">:</span><span class="w"> </span><span class="mi">1e-6</span><span class="p">,</span><span class="w">
          </span><span class="nl">"nl_max_it"</span><span class="w">                    </span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
          </span><span class="nl">"solve_mesh_at_each_iteration"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nl">"mapper_settings"</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
              </span><span class="nl">"mapper_face"</span><span class="w">                           </span><span class="p">:</span><span class="w"> </span><span class="s2">"unique"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"fluid_interface_submodelpart_name"</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">"FluidNoSlipInterface2D_InterfaceFluid"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"structure_interface_submodelpart_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"StructureInterface2D_InterfaceStructure"</span><span class="w">
          </span><span class="p">}],</span><span class="w">
          </span><span class="nl">"coupling_strategy_settings"</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"solver_type"</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="s2">"Relaxation"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"acceleration_type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Aitken"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"w_0"</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="mf">0.825</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nl">"structure_interfaces_list"</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"StructureInterface2D_InterfaceStructure"</span><span class="p">],</span><span class="w">
          </span><span class="nl">"fluid_interfaces_list"</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"FluidNoSlipInterface2D_InterfaceFluid"</span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
    <p>Once the simulation is done, the (mesh) displacement results should be viewed.</p>
  </li>
</ul>

<p>For the CFD partition it looks like this:
<img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi4.jpg" width="750px" class="center" /></p>

<p>For the CSM partition:
<img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi5.jpg" width="750px" class="center" /></p>

<p>One can observe that the deformation of the two domains is consistent. This suggests the proper choice of settings for convergence. This example uses the capabilities of KratosMultiphysics as a black-box. The problem definition setup can be done, for e.g. in GiD. After the creation of the model parts and the initial settings, the user might want or need to change settings in the parameters file to re-run.</p>

<h2 id="2-fsi-customized-sdof-vortex-shedding">2. FSI Customized SDoF vortex shedding</h2>
<p>This example is chosen to show how one could additionally use own - custom python scripts to achieve coupling. The underlying CFD case is that of a rectangular cylinder in constant flow. Harmonic forces arise perpendicular to the flow due to vortex shedding. A single-degree-of-freedom (SDoF) structural model is chosen as the custom CSM solver.</p>

<p>The CFD case results - vortex shedding results can be seen:
<img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi6.jpg" width="750px" class="center" /></p>

<p>For this problem, the SDoF solver is chosen to model the rigid body displacement of the square perpendicular to the flow direction, which leads to the following setup for the FSI:
<img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi7.jpg" width="500px" class="center" /></p>

<p>The necessary parameters files are:</p>
<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ProjectParametersCFD.json</code> : contains all necessary information to setup and run the CFD simulation, as well as the additional mesh moving prerequisites</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">ProjectParametersCSM.json</code> : contains all necessary information to setup and run the CSM simulation (here an SDoF oscillator)
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"problem_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"problem_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CSM"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"time_step"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w">
      </span><span class="nl">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"end_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"model_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"absolute_position"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"mass"</span><span class="p">:</span><span class="w"> </span><span class="mi">1e7</span><span class="p">,</span><span class="w">
      </span><span class="nl">"eigen_freq"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"zeta"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w">
      </span><span class="nl">"rho_inf"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.16</span><span class="p">,</span><span class="w">
      </span><span class="nl">"initial"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"displacement"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"velocity"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"acceleration"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"dof_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DISPLACEMENT_Y"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">ProjectParametersFSI.json</code> : contains all necessary information to setup the mapping and coupling
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"problem_data"</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"problem_name"</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="s2">"FSI"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"time_step"</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w">
      </span><span class="nl">"start_time"</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"end_time"</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
      </span><span class="nl">"echo_level"</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">},</span><span class="w">
  </span><span class="nl">"coupling_settings"</span><span class="p">:{</span><span class="w">
          </span><span class="nl">"mapper_settings"</span><span class="p">:{</span><span class="w">
          </span><span class="nl">"mapper_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sdof"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"interface_submodel_part_destination"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NoSlip2D_structure"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"interface_submodel_part_origin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SDoF_origin"</span><span class="w">
       </span><span class="p">},</span><span class="w">
       </span><span class="nl">"convergence_accelerator_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aitken"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"max_iterations"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
          </span><span class="nl">"residual_relative_tolerance"</span><span class="p">:</span><span class="w"> </span><span class="mi">1e-5</span><span class="p">,</span><span class="w">
          </span><span class="nl">"residual_absolute_tolerance"</span><span class="p">:</span><span class="w"> </span><span class="mi">1e-9</span><span class="p">,</span><span class="w">
          </span><span class="nl">"relaxation_coefficient_initial_value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.25</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<p>The necessary customized python implementation are:</p>
<ul>
  <li>the <strong>CSM solver</strong>: python code in <code class="language-plaintext highlighter-rouge">structure_sdof_solver.py</code>; this has a similar code structure as the application in KratosMultiphysics;</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StructureSDoF</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># Direct time integration of linear SDOF (Generalized-alpha method).
</span>    <span class="c1"># This class takes the undamped eigenfrequency (f, [Hz]) as input
</span>    <span class="k">def</span> <span class="nf">GetDisplacement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">SetDisplacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">displacement</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">Predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">PrintSupportOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">SetExternalForce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ext_force</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_AssembleLHS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_AssembleRHS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">FinalizeSolutionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">SolveSolutionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_IncrementTimeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">Initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">Finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">InitializeSolutionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">AdvanceInTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">OutputSolutionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GetPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></pre></div></div>

<ul>
  <li>the <strong>FSI utilities</strong> (like mapper and convergence accelerator): python code in <code class="language-plaintext highlighter-rouge">fsi_utilities.py</code>
```python
    <h1 id="functionalities-related-to-mapping">functionalities related to mapping</h1>
    <p>def GetDisplacements(structure_solver):
def SetDisplacements(displacements, structure_solver):
def NeumannToStructure(mapper, structure_solver, flag):
def DisplacementToMesh(mapper, displacement, structure_solver):</p>
  </li>
</ul>

<p>def CreateMapper(destination_model_part, mapper_settings):</p>

<p>class CustomMapper(object):</p>

<h1 id="functionalities-related-to-the-convergence-accelerator">functionalities related to the convergence accelerator</h1>
<p>def CreateConvergenceAccelerator(convergence_accelerator_settings):</p>

<p>class ConvergenceAcceleratorBase(object):
    def CalculateResidual(self, solution, old_solution):
    def CalculateRelaxedSolution(self, relaxation_coefficient, old_solution, residual):
    def ComputeRelaxationCoefficient(self):</p>

<p>class AitkenConvergenceAccelerator(ConvergenceAcceleratorBase):
    def ComputeRelaxationCoefficient(self, old_coefficient, residual, old_residual, iteration,</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
* the **main script**: python code in `MainKratosFSI.py`; it is written in a way that it follows the KratosMultiphysics code structure and accommodates the custom python scripts
```python
'''
The initial part takes care of reading in the project parameters and initializing the models
Here we only present the main structure of the computation loop
'''

while(time &lt;= end_time):
    new_time_fluid = fluid_solver._GetSolver().AdvanceInTime(time)
    new_time_structure = structural_solver.AdvanceInTime(time)

    fluid_solver._GetSolver().Predict()
    structural_solver.Predict()

    fluid_solver.InitializeSolutionStep()
    structural_solver.InitializeSolutionStep()

    time = time + delta_time

    residual = 1
    # from the nodes in the structure (origin) on the interface
    old_displacements = fsi_utilities.GetDisplacements(structural_solver)

    num_inner_iter = 1
    ### Inner FSI Loop (executed once in case of explicit coupling)
    for k in range(convergence_accelerator.max_iter):

        fsi_utilities.DisplacementToMesh(mapper, old_displacements, structural_solver)

        # Mesh and Fluid are currently solved independently, since the ALE solver does not copy the mesh velocity
        # Solve Mesh
        fluid_solver._GetSolver().SolveSolutionStep()

        fsi_utilities.NeumannToStructure(mapper, structural_solver, True)

        # Solver Structure
        structural_solver.SolveSolutionStep()

        # Convergence Checking (only for implicit coupling)
        if convergence_accelerator.max_iter &gt; 1:
            displacements = fsi_utilities.GetDisplacements(structural_solver)

            # Compute Residual
            old_residual = residual
            residual = convergence_accelerator.CalculateResidual([displacements], [old_displacements])

            if (fsi_utilities.Norm(residual) &lt;= convergence_accelerator.res_rel_tol):
                fsi_utilities.SetDisplacements(displacements, structural_solver)

                print("******************************************************")
                print("************ CONVERGENCE AT INTERFACE ACHIEVED *******")
                print("******************************************************")
                break
            else:
                relaxation_coefficient = convergence_accelerator.ComputeRelaxationCoefficient(relaxation_coefficient, residual, old_residual, k)
                relaxed_displacements = convergence_accelerator.CalculateRelaxedSolution(relaxation_coefficient, [old_displacements], residual)[0]
                old_displacements = relaxed_displacements
                fsi_utilities.SetDisplacements(relaxed_displacements, structural_solver)

                num_inner_iter += 1

            if (k+1 &gt;= convergence_accelerator.max_iter):
                print("######################################################")
                print("##### CONVERGENCE AT INTERFACE WAS NOT ACHIEVED ######")
                print("######################################################")

            print("==========================================================")
            print("COUPLING RESIDUAL = ", fsi_utilities.Norm(residual))
            print("COUPLING ITERATION = ", k+1, "/", convergence_accelerator.max_iter)
            print("RELAXATION COEFFICIENT = ", relaxation_coefficient)
            print("==========================================================")


    fluid_solver.FinalizeSolutionStep()
    structural_solver.FinalizeSolutionStep()

    fluid_solver.OutputSolutionStep()
    structural_solver.OutputSolutionStep()

    disp = structural_solver.GetDisplacement()
    file_writer.WriteToFile([time, disp, num_inner_iter])

fluid_solver.Finalize()
structural_solver.Finalize()

file_writer.CloseFile()
</code></pre></div></div>

<p>The results for the CFD domain with mesh moving - <em>(mesh) displacement y</em> of the upper left corner of the square (opening <code class="language-plaintext highlighter-rouge">MainModelPart.post.bin</code> in GiD):
<img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi8.jpg" width="750px" class="center" /></p>

<p>The results for the CSM solver plotted with python (using the provided <code class="language-plaintext highlighter-rouge">plot_displacement_results.py</code>) from the resulting ascii file <code class="language-plaintext highlighter-rouge">sdof_csm_displacement_y.dat</code>:
<img src="https://raw.githubusercontent.com/KratosMultiphysics/Documentation/master/Wiki_files/workshop_2019_tutorials/fsi9.jpg" width="750px" class="center" /></p>

<p>The goal of the second example is to show you how you could take one or more existing applications from KratosMultiphysics and coupling these in a customized manner, also including own solver, both carried out in the python layer.</p>

<p>Sources:
The image related to monolithic-partitioned manner is adapted from: W.G. Dettmer: On  Partitioned Solution Strategies for Computational Fluid-­Structure Interaction.
Other images and material is taken from and based upon the lecture content of Structural Wind Engineering WS18-19, Chair of Structural Analysis @ TUM - R. Wüchner, M. Péntek.</p>


    <!-- <div class="tags">
        
        <b>Tags: </b>
        
        
        
        
        
    </div> -->

</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2022 CIMNE. All rights reserved. <br />
 Site last generated: Dec 30, 2022 <br />
<p style="padding-right:32px;"><br><img src="/images/company_logo.png" alt="Company logo" height="100px"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
